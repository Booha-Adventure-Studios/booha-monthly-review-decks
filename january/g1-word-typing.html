<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Booha Review Decks ‚Äì Word Typing</title>
<meta name="theme-color" content="#0b1020" />
<link rel="icon" type="image/png" href="booha-ghost.png">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Noto+Sans+JP:wght@500;700;900&display=swap" rel="stylesheet" />

<style>
:root{
  --bg:#0b1020;
  --ink:#ffffff;
  --good:#22c55e;
  --bad:#ef4444;
  --gold:#ffd166;
  --outline:rgba(255,255,255,.12);

  /* fire (shared feel) */
  --fireA: rgba(255,209,122,.12);
  --fireB: rgba(255,120,70,.08);
  --ringA: rgba(255,209,122,.22);
  --ringB: rgba(255,120,70,.14);
  --pulse1: rgba(255,209,122,.22);
  --pulse2: rgba(255,120,70,.22);

  --unlockGlow: rgba(255,209,122,.00);
  --unlockScale: 1;
  --unlockWobble: 0deg;

  --bgP: rgba(124,58,237,.46); /* purple */
  --bgB: rgba(94,230,255,.30); /* blue */
  --bgG: rgba(255,209,122,.26); /* gold */

  --stormA: rgba(255,126,185,.00);
  --stormB: rgba(94,230,255,.00);
  --stormC: rgba(255,209,122,.00);
  --fireSpark: 0;
}

*{box-sizing:border-box;margin:0;padding:0}
html,body{height:100%}

body{
  background:
    radial-gradient(1200px 760px at 28% 18%, var(--bgP), transparent 58%),
    radial-gradient(980px 720px  at 76% 26%, var(--bgB), transparent 60%),
    radial-gradient(980px 760px  at 52% 92%, var(--bgG), transparent 62%),
    var(--bg);
  color:var(--ink);
  font-family:'Cinzel',serif;
  display:flex;
  align-items:center;
  justify-content:center;
  padding:16px;
  overflow:hidden;
}

/* aurora overlay */
body::before{
  content:"";
  position:fixed;
  inset:-12%;
  pointer-events:none;
  z-index:0;
  background:
    radial-gradient(900px 650px at 20% 20%, rgba(255,126,185,.24), transparent 60%),
    radial-gradient(900px 650px at 82% 30%, rgba(94,230,255,.20), transparent 62%),
    radial-gradient(900px 650px at 55% 85%, rgba(255,209,122,.20), transparent 62%),
    radial-gradient(900px 650px at 35% 65%, rgba(124,58,237,.22), transparent 62%);
  filter: blur(10px) saturate(1.35);
  opacity:.95;
  mix-blend-mode: screen;
  transform: translate3d(0,0,0);
  animation: auroraDrift 8.5s ease-in-out infinite;
}
@keyframes auroraDrift{
  0%   {transform: translate(-2%, -1%) scale(1.02)}
  50%  {transform: translate( 2%,  1%) scale(1.06)}
  100% {transform: translate(-2%, -1%) scale(1.02)}
}

/* fire storm overlay */
body::after{
  content:"";
  position:fixed;
  inset:-10%;
  pointer-events:none;
  z-index:0;
  background:
    radial-gradient(900px 700px at 30% 18%, var(--stormA), transparent 62%),
    radial-gradient(1000px 760px at 70% 28%, var(--stormB), transparent 62%),
    radial-gradient(980px 760px at 50% 86%, var(--stormC), transparent 62%),
    conic-gradient(from 210deg at 50% 45%,
      rgba(255,209,122, calc(.03 + var(--fireSpark)*.06)),
      rgba(255,120,70,  calc(.02 + var(--fireSpark)*.06)),
      rgba(94,230,255,  calc(.02 + var(--fireSpark)*.06)),
      rgba(124,58,237,  calc(.02 + var(--fireSpark)*.06)),
      rgba(255,126,185, calc(.02 + var(--fireSpark)*.06)),
      rgba(255,209,122, calc(.03 + var(--fireSpark)*.06))
    );
  filter: blur(14px) saturate(1.55) contrast(1.05);
  opacity: .85;
  mix-blend-mode: screen;
  animation: fireStorm 3.2s ease-in-out infinite;
}
@keyframes fireStorm{
  0%   {transform: translate(-1.5%, -1%) rotate(-2deg) scale(1.02)}
  50%  {transform: translate( 1.5%,  1%) rotate( 2deg) scale(1.06)}
  100% {transform: translate(-1.5%, -1%) rotate(-2deg) scale(1.02)}
}

/* fire levels */
body.fire1{
  --fireA: rgba(255,209,122,.30);
  --fireB: rgba(255,120,70,.18);
  --ringA: rgba(255,209,122,.44);
  --ringB: rgba(255,120,70,.30);
  --pulse1: rgba(255,209,122,.46);
  --pulse2: rgba(255,120,70,.34);
  --unlockGlow: rgba(255,209,122,.22);
  --unlockScale: 1.00;
  --unlockWobble: 0deg;

  --bgP: rgba(124,58,237,.62);
  --bgB: rgba(94,230,255,.42);
  --bgG: rgba(255,209,122,.44);

  --stormA: rgba(255,126,185,.20);
  --stormB: rgba(94,230,255,.18);
  --stormC: rgba(255,209,122,.18);
  --fireSpark: .45;
}
body.fire2{
  --fireA: rgba(255,209,122,.54);
  --fireB: rgba(255,120,70,.34);
  --ringA: rgba(255,209,122,.68);
  --ringB: rgba(255,120,70,.52);
  --pulse1: rgba(255,209,122,.70);
  --pulse2: rgba(255,120,70,.64);
  --unlockGlow: rgba(255,120,70,.28);
  --unlockScale: 1.01;
  --unlockWobble: 0.4deg;

  --bgP: rgba(124,58,237,.78);
  --bgB: rgba(94,230,255,.52);
  --bgG: rgba(255,209,122,.56);

  --stormA: rgba(255,126,185,.32);
  --stormB: rgba(94,230,255,.28);
  --stormC: rgba(255,209,122,.28);
  --fireSpark: .75;
}
body.fire3{
  --fireA: rgba(255,209,122,.74);
  --fireB: rgba(255,120,70,.56);
  --ringA: rgba(255,209,122,.90);
  --ringB: rgba(255,120,70,.74);
  --pulse1: rgba(255,209,122,.95);
  --pulse2: rgba(255,120,70,.90);
  --unlockGlow: rgba(94,230,255,.30);
  --unlockScale: 1.03;
  --unlockWobble: 0.9deg;

  --bgP: rgba(124,58,237,.92);
  --bgB: rgba(94,230,255,.66);
  --bgG: rgba(255,209,122,.72);

  --stormA: rgba(255,126,185,.44);
  --stormB: rgba(94,230,255,.38);
  --stormC: rgba(255,209,122,.38);
  --fireSpark: 1;
}

/* Top-left Back button */
.backTop{
  position:fixed;
  top:14px;
  left:14px;
  z-index:1000;
  display:inline-flex;
  align-items:center;
  gap:10px;
  padding:10px 14px;
  border-radius:14px;
  text-decoration:none;
  background:rgba(0,0,0,.45);
  border:1px solid rgba(255,255,255,.22);
  color:#fff;
  font-family:'Cinzel',serif;
  font-weight:900;
  backdrop-filter: blur(4px);
  -webkit-tap-highlight-color: transparent;
}
.backTop span{
  font-family:'Noto Sans JP',system-ui;
  font-weight:900;
  color:#d7d7d7;
}

/* Card */
.card{
  width:min(760px,94vw);
  background:rgba(0,0,0,.35);
  border-radius:26px;
  padding:26px 22px 20px;
  text-align:center;
  box-shadow:0 20px 60px rgba(0,0,0,.5);
  border:1px solid var(--outline);
  position:relative;
  z-index:1;
  transform: scale(var(--unlockScale)) rotate(var(--unlockWobble));
  transition: transform .25s ease, box-shadow .25s ease, border-color .25s ease;
}

/* fire ring on card (same vibe as Pick the Sentence) */
.fireRing{
  position:absolute;
  inset:10px;
  border-radius: 18px;
  pointer-events:none;
  opacity:0;
  background:
    radial-gradient(600px 220px at 30% 0%, var(--ringA), transparent 62%),
    radial-gradient(600px 240px at 70% 0%, var(--ringB), transparent 62%),
    radial-gradient(700px 260px at 50% 110%, rgba(255,209,122,.14), transparent 62%);
  filter: drop-shadow(0 0 18px rgba(255,209,122,.38));
}
body.fire1 .fireRing,
body.fire2 .fireRing,
body.fire3 .fireRing{opacity:1; animation: firePulse 0.9s ease-in-out infinite}
body.fire3 .fireRing{animation-duration:.65s;}
@keyframes firePulse{
  0%,100%{filter: drop-shadow(0 0 22px var(--pulse1));}
  50%{filter: drop-shadow(0 0 44px var(--pulse2));}
}

/* Perfect run gold frame */
.card.perfect{
  border:2px solid rgba(255,209,102,.65);
  box-shadow:
    0 0 18px rgba(255,209,102,.28),
    0 0 46px rgba(255,209,102,.20),
    0 22px 70px rgba(0,0,0,.55);
}
.card.perfect::after{
  content:"";
  position:absolute;
  inset:-10px;
  border-radius:32px;
  pointer-events:none;
  background:conic-gradient(from 0deg,
    rgba(255,255,255,0) 0%,
    rgba(255,241,179,.75) 12%,
    rgba(255,255,255,0) 24%,
    rgba(255,209,102,.80) 38%,
    rgba(255,255,255,0) 52%,
    rgba(255,241,179,.70) 68%,
    rgba(255,255,255,0) 82%,
    rgba(255,209,102,.80) 94%,
    rgba(255,255,255,0) 100%
  );
  opacity:.55;
  filter:blur(0.6px);
  animation:goldSpin 3.6s linear infinite;
  mask:
    linear-gradient(#000 0 0) content-box,
    linear-gradient(#000 0 0);
  -webkit-mask:
    linear-gradient(#000 0 0) content-box,
    linear-gradient(#000 0 0);
  padding:10px;
}
@keyframes goldSpin{to{transform:rotate(360deg)}}

/* Header */
.header{
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:6px;
}
h1{
  font-size:clamp(26px,4.6vw,44px);
  font-weight:900;
  letter-spacing:.05em;
  line-height:1.05;
}
h1 small{
  display:block;
  margin-top:6px;
  font-family:'Noto Sans JP',system-ui;
  font-size:clamp(15px,2.6vw,22px);
  font-weight:900;
  color:#d7d7d7;
  letter-spacing:.02em;
}
.counter{
  margin-top:10px;
  font-size:14px;
  color:#cbd5e1;
}

/* Prompt */
.jp{
  margin-top:22px;
  font-family:'Noto Sans JP',system-ui;
  font-size:clamp(28px,5.2vw,40px);
  font-weight:900;
  letter-spacing:.02em;
}
.hira{
  margin-top:6px;
  font-family:'Noto Sans JP',system-ui;
  font-size:clamp(14px,2.6vw,18px);
  color:#cbd5e1;
}

/* Input + button */
input{
  margin-top:18px;
  width:100%;
  font-size:22px;
  padding:14px 16px;
  border-radius:16px;
  border:none;
  outline:none;
  text-align:center;
}
button{
  margin-top:14px;
  width:100%;
  padding:14px;
  font-size:20px;
  border-radius:16px;
  border:none;
  font-weight:900;
  cursor:pointer;
  background:linear-gradient(145deg,var(--gold),#fff1b3);
}

.feedback{
  margin-top:14px;
  min-height:52px;
  display:flex;
  align-items:center;
  justify-content:center;
}

.heart{
  font-size:46px;
  color:var(--good);
  animation:pop .6s ease;
}
@keyframes pop{
  0%{transform:scale(.6);opacity:0}
  60%{transform:scale(1.2)}
  100%{transform:scale(1)}
}
.fart{
  font-size:44px;
  color:var(--bad);
  animation:shake .4s ease;
}
@keyframes shake{
  0%{transform:translateX(0)}
  25%{transform:translateX(-7px)}
  50%{transform:translateX(7px)}
  75%{transform:translateX(-5px)}
  100%{transform:translateX(0)}
}

.hint{
  margin-top:6px;
  font-size:14px;
  color:#ffd166;
  min-height:18px;
}

/* Result */
#result{display:none}
.score{
  margin-top:18px;
  font-size:44px;
  font-weight:900;
}
.good{color:#22c55e}
.mid{color:#ffd166}
.bad{color:#ef4444}

/* Perfect text */
.perfectTag{
  margin-top:12px;
  font-family:'Cinzel',serif;
  font-weight:900;
  letter-spacing:.08em;
  color:#ffd166;
  text-shadow:0 0 10px rgba(255,209,102,.35), 0 0 22px rgba(255,209,102,.22);
  font-size:clamp(16px,2.6vw,20px);
}
.perfectTag small{
  display:block;
  margin-top:6px;
  font-family:'Noto Sans JP',system-ui;
  letter-spacing:.02em;
  color:#ffe7b5;
  font-weight:900;
}

/* Footer */
footer{
  width:100%;
  margin-top:14px;
  text-align:center;
  font-family:'Cinzel',serif;
  font-weight:900;
  color:#cbd5e1;
  font-size:18px;
  letter-spacing:.06em;
}

.bottom{
  margin-top:18px;
  display:flex;
  gap:10px;
  flex-wrap:wrap;
  justify-content:center;
  align-items:center;
}
a.back{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  padding:10px 14px;
  border-radius:14px;
  text-decoration:none;
  background:rgba(255,255,255,.10);
  border:1px solid rgba(255,255,255,.18);
  color:#fff;
  font-family:'Cinzel',serif;
  font-weight:900;
  -webkit-tap-highlight-color: transparent;
}
a.back span{
  font-family:'Noto Sans JP',system-ui;
  font-weight:900;
  color:#d7d7d7;
}

/* Fire popup */
.fireBanner{
  position:fixed;
  left:50%;
  top: calc(env(safe-area-inset-top) + 92px);
  transform: translateX(-50%) translateY(-8px);
  z-index:1200;

  display:flex;
  align-items:center;
  gap:14px;
  padding:16px 22px;
  border-radius:999px;

  background: rgba(255,209,122,.30);
  border:1px solid rgba(255,209,122,.55);
  box-shadow:
    0 18px 50px rgba(0,0,0,.55),
    0 0 90px rgba(255,120,70, calc(.10 + var(--fireSpark)*.12));
  backdrop-filter: blur(6px);

  opacity:0;
  pointer-events:none;
  transition: opacity .18s ease, transform .18s ease;
  text-align:center;
}
.fireBanner.show{
  opacity:1;
  transform: translateX(-50%) translateY(0);
}
.fireBanner .en{
  font-family:'Cinzel',serif;
  font-weight:900;
  letter-spacing:.4px;
  font-size:22px;
  line-height:1.05;
}
.fireBanner .jp{
  font-family:'Noto Sans JP',sans-serif;
  font-weight:900;
  font-size:18px;
  line-height:1.05;
  opacity:.95;
}
.fireDot{
  width:16px;height:16px;border-radius:999px;
  background: radial-gradient(circle at 30% 30%, #fff6d8, #ffd17a 45%, #ff6b3d 100%);
  box-shadow: 0 0 24px rgba(255,209,122,.70);
}

@media (max-width: 520px){
  input{font-size:20px}
  button{font-size:19px}
  .backTop{top:10px;left:10px;padding:9px 12px}
}
</style>
</head>
<body>

<a class="backTop" href="index.html">Back to Menu <span>„É°„Éã„É•„Éº„Å∏</span></a>

<div class="card" id="card">
  <div class="fireRing" aria-hidden="true"></div>

  <div id="game">
    <div class="header">
      <h1>Word Typing<small>„Çø„Ç§„Éî„É≥„Ç∞</small></h1>
      <div class="counter" id="counter">1 / 60</div>
    </div>

    <div class="jp" id="jp"></div>
    <div class="hira" id="hira"></div>

    <input id="answer" autocomplete="off" autocapitalize="none" spellcheck="false" />
    <button id="submit">OK</button>

    <div class="feedback" id="feedback"></div>
    <div class="hint" id="hint"></div>

    <footer>Bryan's English School</footer>
  </div>

  <div id="result">
    <div class="header">
      <h1>RESULT<small>„Åë„Å£„Åã</small></h1>
    </div>

    <div class="score" id="score"></div>
    <div class="perfectTag" id="perfectTag" style="display:none;">
      PERFECT RUN
      <small>„Éë„Éº„Éï„Çß„ÇØ„ÉàÔºÅ</small>
    </div>

    <div class="bottom">
      <a class="back" href="index.html">Back to Menu <span>„É°„Éã„É•„Éº„Å∏</span></a>
      <a class="back" href="" id="retryLink">Try Again <span>„ÇÇ„ÅÜ‰∏ÄÂõû</span></a>
    </div>

    <footer>Bryan's English School</footer>
  </div>
</div>

<!-- Fire popup -->
<div class="fireBanner" id="fireBanner" role="status" aria-live="polite">
  <span class="fireDot" aria-hidden="true"></span>
  <div class="en" id="fireEn">You‚Äôre on fire!</div>
  <div class="jp" id="fireJp">„Éé„Å£„Å¶„Åç„ÅüÔºÅ</div>
</div>

<script>
function $(q){ return document.querySelector(q); }

/* =========================
   SFX (pool + preload + iOS unlock)
   Files are in SAME folder:
   ding.mp3, fart.mp3, fire.mp3
   ========================= */
function makePool(src, size){
  const pool = [];
  for(let i=0;i<size;i++){
    const a = new Audio(src);
    a.preload = "auto";
    a.volume = 1;
    pool.push(a);
  }
  let n = 0;
  return {
    play(vol=1){
      const a = pool[n];
      n = (n+1) % pool.length;
      try{
        a.volume = vol;
        a.currentTime = 0;
        const p = a.play();
        if(p && p.catch) p.catch(()=>{});
      }catch(e){}
    },
    prime(){
      pool.forEach(a=>{
        try{
          const prev = a.volume;
          a.volume = 0;
          a.currentTime = 0;
          const p = a.play();
          if(p && p.then){
            p.then(()=>setTimeout(()=>{
              try{ a.pause(); a.currentTime=0; a.volume=prev; }catch(e){}
            }, 30)).catch(()=>{ try{ a.volume=prev; }catch(e){} });
          }else{
            setTimeout(()=>{ try{ a.pause(); a.currentTime=0; a.volume=prev; }catch(e){} }, 30);
          }
        }catch(e){}
      });
    }
  };
}

const SFX = {
  ding: makePool("ding.mp3", 4),
  fart: makePool("fart.mp3", 4),
  fire: makePool("fire.mp3", 3)
};

let audioUnlocked = false;
function unlockAudioOnce(){
  if(audioUnlocked) return;
  audioUnlocked = true;
  SFX.ding.prime();
  SFX.fart.prime();
  SFX.fire.prime();
}
window.addEventListener("pointerdown", unlockAudioOnce, { once:true, passive:true });
window.addEventListener("touchstart", unlockAudioOnce, { once:true, passive:true });

/* =========================
   DATA (shuffle order each run)
   ========================= */
const DATA = [
  {en:'mind', jp:'ÂøÉ', hi:'„Åì„Åì„Çç'},
  {en:'heart', jp:'ÂøÉ', hi:'„Åì„Åì„Çç'},
  {en:'focus', jp:'ÈõÜ‰∏≠', hi:'„Åó„ÇÖ„ÅÜ„Å°„ÇÖ„ÅÜ'},
  {en:'relax', jp:'„É™„É©„ÉÉ„ÇØ„Çπ„Åô„Çã', hi:'„Çä„Çâ„Å£„Åè„Åô „Åô„Çã'},
  {en:'mistake', jp:'ÈñìÈÅï„ÅÑ', hi:'„Åæ„Å°„Åå„ÅÑ'},
  {en:'improve', jp:'‰∏äÈÅî„Åô„Çã', hi:'„Åò„Çá„ÅÜ„Åü„Å§ „Åô„Çã'},
  {en:'believe', jp:'‰ø°„Åò„Çã', hi:'„Åó„Çì„Åò„Çã'},
  {en:'effort', jp:'Âä™Âäõ', hi:'„Å©„Çä„Çá„Åè'},
  {en:'attitude', jp:'ÊÖãÂ∫¶', hi:'„Åü„ÅÑ„Å©'},
  {en:'courage', jp:'ÂãáÊ∞ó', hi:'„ÇÜ„ÅÜ„Åç'},
  {en:'happy', jp:'Âπ∏„Åõ', hi:'„Åó„ÅÇ„Çè„Åõ'},

  {en:'body', jp:'‰Ωì', hi:'„Åã„Çâ„Å†'},
  {en:'head', jp:'È†≠', hi:'„ÅÇ„Åü„Åæ'},
  {en:'stomach', jp:'„ÅäËÖπ', hi:'„Åä„Å™„Åã'},
  {en:'sleep', jp:'ÂØù„Çã', hi:'„Å≠„Çã'},
  {en:'food', jp:'È£ü„ÅπÁâ©', hi:'„Åü„Åπ„ÇÇ„ÅÆ'},
  {en:'fruit', jp:'ÊûúÁâ©', hi:'„Åè„Å†„ÇÇ„ÅÆ'},
  {en:'vegetable', jp:'ÈáéËèú', hi:'„ÇÑ„Åï„ÅÑ'},
  {en:'exercise', jp:'ÈÅãÂãï', hi:'„ÅÜ„Çì„Å©„ÅÜ'},
  {en:'walk', jp:'Ê≠©„Åè', hi:'„ÅÇ„Çã„Åè'},
  {en:'run', jp:'Ëµ∞„Çã', hi:'„ÅØ„Åó„Çã'},
  {en:'drink', jp:'È£≤„ÇÄ', hi:'„ÅÆ„ÇÄ'},
  {en:'water', jp:'Ê∞¥', hi:'„Åø„Åö'},
  {en:'strong', jp:'Âº∑„ÅÑ', hi:'„Å§„Çà„ÅÑ'},
  {en:'tired', jp:'Áñ≤„Çå„Åü', hi:'„Å§„Åã„Çå„Åü'},
  {en:'healthy', jp:'ÂÅ•Â∫∑', hi:'„Åë„Çì„Åì„ÅÜ'},

  {en:'morning', jp:'Êúù', hi:'„ÅÇ„Åï'},
  {en:'night', jp:'Â§ú', hi:'„Çà„Çã'},
  {en:'breakfast', jp:'Êúù„Åî„ÅØ„Çì', hi:'„ÅÇ„Åï„Åî„ÅØ„Çì'},
  {en:'lunch', jp:'Êòº„Åî„ÅØ„Çì', hi:'„Å≤„Çã„Åî„ÅØ„Çì'},
  {en:'dinner', jp:'Â§ïÈ£ü', hi:'„ÇÜ„ÅÜ„Åó„Çá„Åè'},
  {en:'brush', jp:'Ê≠Ø„Çí„Åø„Åå„Åè', hi:'„ÅØ „Çí „Åø„Åå„Åè'},
  {en:'wash', jp:'Ê¥ó„ÅÜ', hi:'„ÅÇ„Çâ„ÅÜ'},
  {en:'go', jp:'Ë°å„Åè', hi:'„ÅÑ„Åè'},
  {en:'come', jp:'Êù•„Çã', hi:'„Åè„Çã'},
  {en:'study', jp:'ÂãâÂº∑', hi:'„Åπ„Çì„Åç„Çá„ÅÜ'},
  {en:'homework', jp:'ÂÆøÈ°å', hi:'„Åó„ÇÖ„Åè„Å†„ÅÑ'},
  {en:'clean', jp:'ÊéÉÈô§„Åô„Çã', hi:'„Åù„ÅÜ„Åò „Åô„Çã'},
  {en:'start', jp:'Âßã„ÇÅ„Çã', hi:'„ÅØ„Åò„ÇÅ„Çã'},
  {en:'finish', jp:'ÁµÇ„Çè„Çã', hi:'„Åä„Çè„Çã'},

  {en:'goal', jp:'ÁõÆÊ®ô', hi:'„ÇÇ„Åè„Å≤„Çá„ÅÜ'},
  {en:'plan', jp:'Ë®àÁîª', hi:'„Åë„ÅÑ„Åã„Åè'},
  {en:'future', jp:'Êú™Êù•', hi:'„Åø„Çâ„ÅÑ'},
  {en:'dream', jp:'Â§¢', hi:'„ÇÜ„ÇÅ'},
  {en:'challenge', jp:'ÊåëÊà¶', hi:'„Å°„Çá„ÅÜ„Åõ„Çì'},
  {en:'change', jp:'Â§â„Åà„Çã', hi:'„Åã„Åà„Çã'},
  {en:'habit', jp:'ÁøíÊÖ£', hi:'„Åó„ÇÖ„ÅÜ„Åã„Çì'},
  {en:'practice', jp:'Á∑¥Áøí', hi:'„Çå„Çì„Åó„ÇÖ„ÅÜ'},
  {en:'motivation', jp:'„ÇÑ„ÇãÊ∞ó', hi:'„ÇÑ„Çã„Åç'}
];

function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]]=[a[j],a[i]];
  }
  return a;
}

let order = [];
let idx = 0;
let score = 0;
let mistakes = 0;
let anyWrongEver = false;
let streak = 0;
let bannerTimer = null;

/* hooks */
const jpEl = $('#jp');
const hiraEl = $('#hira');
const ansEl = $('#answer');
const fbEl = $('#feedback');
const hintEl = $('#hint');
const counterEl = $('#counter');
const submitBtn = $('#submit');
const cardEl = $('#card');

const fireBanner = $('#fireBanner');
const fireEn = $('#fireEn');
const fireJp = $('#fireJp');

/* fire level from streak */
function setFireLevelFromStreak(){
  document.body.classList.remove("fire1","fire2","fire3");
  if(streak >= 10) document.body.classList.add("fire3");
  else if(streak >= 6) document.body.classList.add("fire2");
  else if(streak >= 3) document.body.classList.add("fire1");
}

/* fire popup */
function showFireBanner(level){
  const msg = {
    1: { en:"You‚Äôre on fire!",           jp:"„Éé„Å£„Å¶„Åç„ÅüÔºÅ" },
    2: { en:"You‚Äôre on mega fire!",      jp:"„Åæ„Åò„Åß„Éé„Å£„Å¶„ÇãÔºÅ" },
    3: { en:"You are a S≈´pƒÅ Saiya-jin!", jp:"„Çπ„Éº„Éë„Éº„Çµ„Ç§„É§‰∫∫„Å†ÔºÅ" }
  }[level];
  if(!msg) return;

  fireEn.textContent = msg.en;
  fireJp.textContent = msg.jp;

  fireBanner.classList.add("show");
  clearTimeout(bannerTimer);
  bannerTimer = setTimeout(()=>fireBanner.classList.remove("show"), 3500);

  SFX.fire.play(1);
}

/* reset / shuffle */
function resetGame(){
  order = shuffle([...Array(DATA.length)].map((_,i)=>i)); // shuffle QUESTIONS
  idx = 0;
  score = 0;
  mistakes = 0;
  anyWrongEver = false;
  streak = 0;

  document.body.classList.remove("fire1","fire2","fire3");
  fireBanner.classList.remove("show");
  clearTimeout(bannerTimer);

  $('#game').style.display='block';
  $('#result').style.display='none';
  cardEl.classList.remove('perfect');
  $('#perfectTag').style.display='none';
}

/* load prompt */
function load(){
  const d = DATA[order[idx]];
  jpEl.textContent = d.jp;
  hiraEl.textContent = d.hi;
  ansEl.value='';
  fbEl.textContent='';
  hintEl.textContent='';
  mistakes=0;
  counterEl.textContent = (idx+1) + ' / ' + DATA.length;
  submitBtn.textContent = 'OK';
  setFireLevelFromStreak();
  ansEl.focus();
}

/* check answer */
function check(){
  const d = DATA[order[idx]];
  const typed = ansEl.value.trim().toLowerCase();

  if(typed === d.en){
    score++;
    streak++;
    fbEl.innerHTML = '<div class="heart">‚ù§</div>';
    hintEl.textContent = '';
    submitBtn.textContent = 'OK';

    // play first (snappier)
    SFX.ding.play(1);

    if(streak === 3)  showFireBanner(1);
    if(streak === 6)  showFireBanner(2);
    if(streak === 10) showFireBanner(3);

    setFireLevelFromStreak();
    setTimeout(next, 650);
  }else{
    anyWrongEver = true;
    mistakes++;
    streak = 0;

    fbEl.innerHTML = '<div class="fart">üí®</div>';
    submitBtn.textContent = '„ÇÇ„ÅÜ‰∏ÄÂõû';

    SFX.fart.play(1);
    setFireLevelFromStreak();

    if(mistakes >= 3){
      hintEl.textContent = 'Hint: ' + d.en[0] + '...';
    }
  }
}

/* next */
function next(){
  idx++;
  if(idx >= order.length) finish();
  else load();
}

/* finish */
function finish(){
  $('#game').style.display='none';
  $('#result').style.display='block';

  const pct = Math.round((score / DATA.length) * 100);
  const s = $('#score');
  s.textContent = pct + '%';
  s.className = 'score ' + (pct>=80?'good':pct>=50?'mid':'bad');

  const retry = $('#retryLink');
  if(retry) retry.href = window.location.pathname.split('/').pop() || '';

  if(!anyWrongEver){
    cardEl.classList.add('perfect');
    $('#perfectTag').style.display='block';
  }
}

/* events */
submitBtn.addEventListener('click', check);
ansEl.addEventListener('keydown', (e)=>{ if(e.key==='Enter') check(); });

/* boot */
resetGame();
load();
</script>
</body>
</html>
