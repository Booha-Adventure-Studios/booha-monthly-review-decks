<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Booha Review Decks – Pick the Sentence (January)</title>
<meta name="theme-color" content="#0b1020" />
<link rel="icon" type="image/png" href="BoohaYellow.png">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Noto+Sans+JP:wght@500;700;900&display=swap" rel="stylesheet" />

<style>
:root{
  --bg:#0b1020;
  --panel:#0f172a;
  --panel2:#0b1327;
  --ink:#ffffff;
  --muted:#cbd5e1;
  --outline:rgba(255,255,255,.18);
  --good:#22c55e;
  --bad:#e53935;
  --gold:#ffd17a;
  --shadow: 0 18px 45px rgba(0,0,0,.45);
  --radius:28px;
  --btnR:22px;

  /* big readable sizes */
  --jpSize: clamp(26px, 3.3vw, 44px);
  --hiSize: clamp(18px, 2.4vw, 30px);
  --enSize: clamp(20px, 2.6vw, 34px);
  --hudSize: 14px;

  /* fire intensity (overridden by body classes) */
  --fireA: rgba(255,209,122,.12);
  --fireB: rgba(255,120,70,.08);
  --ringA: rgba(255,209,122,.22);
  --ringB: rgba(255,120,70,.14);
  --pulse1: rgba(255,209,122,.22);
  --pulse2: rgba(255,120,70,.22);

  /* extra “unlock” controls */
  --unlockGlow: rgba(255,209,122,.00);
  --unlockScale: 1;
  --unlockWobble: 0deg;

  /* stronger background color controls */
  --bgP: rgba(124,58,237,.46); /* purple */
  --bgB: rgba(94,230,255,.30); /* blue */
  --bgG: rgba(255,209,122,.26); /* gold */

  /* NEW: ultra fire overlays */
  --stormA: rgba(255,126,185,.00);
  --stormB: rgba(94,230,255,.00);
  --stormC: rgba(255,209,122,.00);
  --fireSpark: 0;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  background:
    radial-gradient(1200px 760px at 28% 18%, var(--bgP), transparent 58%),
    radial-gradient(980px 720px  at 76% 26%, var(--bgB), transparent 60%),
    radial-gradient(980px 760px  at 52% 92%, var(--bgG), transparent 62%),
    var(--bg);
  color:var(--ink);
  font-family:'Cinzel', serif;
  overflow:hidden;
}

/* animated aurora overlay */
body::before{
  content:"";
  position:fixed;
  inset:-12%;
  pointer-events:none;
  z-index:0;
  background:
    radial-gradient(900px 650px at 20% 20%, rgba(255,126,185,.24), transparent 60%),
    radial-gradient(900px 650px at 82% 30%, rgba(94,230,255,.20), transparent 62%),
    radial-gradient(900px 650px at 55% 85%, rgba(255,209,122,.20), transparent 62%),
    radial-gradient(900px 650px at 35% 65%, rgba(124,58,237,.22), transparent 62%);
  filter: blur(10px) saturate(1.35);
  opacity:.95;
  mix-blend-mode: screen;
  transform: translate3d(0,0,0);
  animation: auroraDrift 8.5s ease-in-out infinite;
}
@keyframes auroraDrift{
  0%   {transform: translate(-2%, -1%) scale(1.02)}
  50%  {transform: translate( 2%,  1%) scale(1.06)}
  100% {transform: translate(-2%, -1%) scale(1.02)}
}

/* NEW: fire storm overlay (gets intense with fire levels) */
body::after{
  content:"";
  position:fixed;
  inset:-10%;
  pointer-events:none;
  z-index:0;
  background:
    radial-gradient(900px 700px at 30% 18%, var(--stormA), transparent 62%),
    radial-gradient(1000px 760px at 70% 28%, var(--stormB), transparent 62%),
    radial-gradient(980px 760px at 50% 86%, var(--stormC), transparent 62%),
    conic-gradient(from 210deg at 50% 45%,
      rgba(255,209,122, calc(.03 + var(--fireSpark)*.06)),
      rgba(255,120,70,  calc(.02 + var(--fireSpark)*.06)),
      rgba(94,230,255,  calc(.02 + var(--fireSpark)*.06)),
      rgba(124,58,237,  calc(.02 + var(--fireSpark)*.06)),
      rgba(255,126,185, calc(.02 + var(--fireSpark)*.06)),
      rgba(255,209,122, calc(.03 + var(--fireSpark)*.06))
    );
  filter: blur(14px) saturate(1.55) contrast(1.05);
  opacity: .85;
  mix-blend-mode: screen;
  animation: fireStorm 3.2s ease-in-out infinite;
}
@keyframes fireStorm{
  0%   {transform: translate(-1.5%, -1%) rotate(-2deg) scale(1.02)}
  50%  {transform: translate( 1.5%,  1%) rotate( 2deg) scale(1.06)}
  100% {transform: translate(-1.5%, -1%) rotate(-2deg) scale(1.02)}
}

/* 3 fire levels (now much louder visually) */
body.fire1{
  --fireA: rgba(255,209,122,.30);
  --fireB: rgba(255,120,70,.18);
  --ringA: rgba(255,209,122,.44);
  --ringB: rgba(255,120,70,.30);
  --pulse1: rgba(255,209,122,.46);
  --pulse2: rgba(255,120,70,.34);
  --unlockGlow: rgba(255,209,122,.22);
  --unlockScale: 1.00;
  --unlockWobble: 0deg;

  --bgP: rgba(124,58,237,.62);
  --bgB: rgba(94,230,255,.42);
  --bgG: rgba(255,209,122,.44);

  --stormA: rgba(255,126,185,.20);
  --stormB: rgba(94,230,255,.18);
  --stormC: rgba(255,209,122,.18);
  --fireSpark: .45;
}

body.fire2{
  --fireA: rgba(255,209,122,.54);
  --fireB: rgba(255,120,70,.34);
  --ringA: rgba(255,209,122,.68);
  --ringB: rgba(255,120,70,.52);
  --pulse1: rgba(255,209,122,.70);
  --pulse2: rgba(255,120,70,.64);
  --unlockGlow: rgba(255,120,70,.28);
  --unlockScale: 1.01;
  --unlockWobble: 0.4deg;

  --bgP: rgba(124,58,237,.78);
  --bgB: rgba(94,230,255,.52);
  --bgG: rgba(255,209,122,.56);

  --stormA: rgba(255,126,185,.32);
  --stormB: rgba(94,230,255,.28);
  --stormC: rgba(255,209,122,.28);
  --fireSpark: .75;
}

body.fire3{
  --fireA: rgba(255,209,122,.74);
  --fireB: rgba(255,120,70,.56);
  --ringA: rgba(255,209,122,.90);
  --ringB: rgba(255,120,70,.74);
  --pulse1: rgba(255,209,122,.95);
  --pulse2: rgba(255,120,70,.90);
  --unlockGlow: rgba(94,230,255,.30);
  --unlockScale: 1.03;
  --unlockWobble: 0.9deg;

  --bgP: rgba(124,58,237,.92);
  --bgB: rgba(94,230,255,.66);
  --bgG: rgba(255,209,122,.72);

  --stormA: rgba(255,126,185,.44);
  --stormB: rgba(94,230,255,.38);
  --stormC: rgba(255,209,122,.38);
  --fireSpark: 1;
}

body.fire1, body.fire2, body.fire3{
  background:
    radial-gradient(1100px 760px at 50% 16%, var(--fireA), transparent 60%),
    radial-gradient(980px 720px  at 50% 46%, var(--fireB), transparent 62%),
    radial-gradient(980px 760px  at 50% 92%, rgba(255,209,122,.20), transparent 62%),
    radial-gradient(1200px 760px at 28% 18%, var(--bgP), transparent 58%),
    radial-gradient(980px 720px  at 76% 26%, var(--bgB), transparent 60%),
    radial-gradient(980px 760px  at 52% 92%, var(--bgG), transparent 62%),
    var(--bg);
}

/* layer above aurora overlay */
.wrap{
  position:relative;
  z-index:1;
  height:100%;
  display:flex;
  flex-direction:column;
  padding: max(14px, env(safe-area-inset-top)) 14px max(14px, env(safe-area-inset-bottom));
  gap:12px;
}

.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}

.back{
  appearance:none;
  border:0;
  background:rgba(255,255,255,.10);
  color:#fff;
  padding:10px 14px;
  border-radius:999px;
  font-family:'Cinzel',serif;
  font-weight:900;
  letter-spacing:.4px;
  box-shadow: 0 10px 24px rgba(0,0,0,.35);
  border:1px solid rgba(255,255,255,.18);
  cursor:pointer;
  display:flex;
  align-items:baseline;
  gap:10px;
}
.back span.jp{
  font-family:'Noto Sans JP',sans-serif;
  font-weight:900;
  font-size:12px;
  opacity:.95;
}

.hud{
  display:flex;
  align-items:center;
  gap:10px;
  font-family:'Noto Sans JP',sans-serif;
  font-size:var(--hudSize);
  color:var(--muted);
  user-select:none;
}
.hud .pill{
  padding:8px 10px;
  border-radius:999px;
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.14);
}
.hud b{color:#fff}

.stage{
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:14px;
  min-height:0;
}

.card{
  width:min(980px, 100%);
  border-radius:var(--radius);
  background: linear-gradient(180deg, rgba(255,255,255,.10), rgba(255,255,255,.05));
  border:1px solid rgba(255,255,255,.18);
  box-shadow: var(--shadow);
  padding:18px 18px 16px;
  position:relative;
  overflow:hidden;
  transform: scale(var(--unlockScale)) rotate(var(--unlockWobble));
  transition: transform .25s ease, box-shadow .25s ease;
}

body.fire2 .card,
body.fire3 .card{
  box-shadow:
    var(--shadow),
    0 0 50px var(--unlockGlow),
    0 0 120px rgba(255,209,122, calc(.06 + var(--fireSpark)*.10));
}
body.fire3 .card{
  animation: cardThrill 0.85s ease-in-out infinite;
}
@keyframes cardThrill{
  0%,100%{ transform: scale(var(--unlockScale)) rotate(calc(var(--unlockWobble) * -1)); }
  50%{ transform: scale(calc(var(--unlockScale) + .015)) rotate(var(--unlockWobble)); }
}

.card::before{
  content:"";
  position:absolute;
  inset:-2px;
  border-radius:var(--radius);
  background:
    radial-gradient(520px 220px at 30% 0%, rgba(255,255,255,.12), transparent 60%),
    radial-gradient(560px 260px at 80% 0%, rgba(255,209,122,.18), transparent 62%),
    radial-gradient(900px 380px at 50% 120%, rgba(255,120,70, calc(.06 + var(--fireSpark)*.10)), transparent 62%);
  pointer-events:none;
}

.prompt{
  position:relative;
  z-index:1;
  text-align:center;
  padding:14px 8px 8px;
}

.jp{
  font-family:'Noto Sans JP',sans-serif;
  font-weight:900;
  font-size:var(--jpSize);
  line-height:1.12;
  text-shadow: 0 10px 26px rgba(0,0,0,.45);
}

.hira{
  margin-top:10px;
  font-family:'Noto Sans JP',sans-serif;
  font-weight:800;
  font-size:var(--hiSize);
  line-height:1.12;
  color: rgba(255,255,255,.92);
  opacity:.95;
}

.grid{
  width:min(980px, 100%);
  display:grid;
  grid-template-columns: 1fr;
  gap:12px;
}
@media (min-width: 820px){
  .grid{grid-template-columns: 1fr 1fr;}
}

/* CHOICE TILES */
.choice{
  position:relative;
  border-radius:var(--btnR);
  padding:16px 16px 18px;
  background:#ffffff;
  border:1px solid rgba(255,255,255,.18);
  box-shadow: 0 12px 28px rgba(0,0,0,.35);
  cursor:pointer;
  user-select:none;
  transition: transform .12s ease, filter .12s ease, box-shadow .12s ease;
  overflow:hidden;
}
.choice:hover{transform: translateY(-1px)}
.choice:active{transform: translateY(0px) scale(.995)}

.choice .en{
  font-family: Arial, Helvetica, sans-serif;
  font-weight: 800;
  font-size: var(--enSize);
  line-height: 1.15;
  color: #0b1020;
  text-transform: none;
  letter-spacing: 0;
  text-shadow: none;
}

.choice.locked{pointer-events:none; opacity:.92}

.choice.correct{
  border-color: #22c55e;
  box-shadow:
    0 0 0 6px rgba(34,197,94,.35),
    0 0 40px rgba(34,197,94,.90),
    0 0 90px rgba(34,197,94,.45),
    0 12px 28px rgba(0,0,0,.35);
  animation: correctFlash .22s ease-out;
}
@keyframes correctFlash{ from{transform: scale(.96);} to{transform: scale(1);} }

.choice.wrong{
  border-color: #ff3b3b;
  box-shadow:
    0 0 0 6px rgba(255,59,59,.35),
    0 0 45px rgba(255,59,59,.85),
    0 0 95px rgba(255,59,59,.45),
    0 12px 28px rgba(0,0,0,.35);
  animation: shake .45s ease;
}
@keyframes shake{
  0%,100%{transform:translateX(0)}
  20%{transform:translateX(-10px)}
  40%{transform:translateX(10px)}
  60%{transform:translateX(-7px)}
  80%{transform:translateX(7px)}
}

/* NEW: Show correct answer on wrong */
.choice.revealCorrect{
  border-color: rgba(255,209,122,.95);
  box-shadow:
    0 0 0 6px rgba(255,209,122,.32),
    0 0 48px rgba(255,209,122,.55),
    0 12px 28px rgba(0,0,0,.35);
}
.choice.revealCorrect::after{
  content:"✓ CORRECT";
  position:absolute;
  right:14px; top:12px;
  font-family:'Cinzel',serif;
  font-weight:900;
  letter-spacing:.5px;
  font-size:12px;
  padding:6px 10px;
  border-radius:999px;
  color:#0b1020;
  background: rgba(255,209,122,.95);
  box-shadow: 0 10px 24px rgba(0,0,0,.35);
}

/* Fire ring */
.fireRing{
  position:absolute;
  inset:10px;
  border-radius: calc(var(--radius) - 10px);
  pointer-events:none;
  opacity:0;
  transition: opacity .25s ease;
  background:
    radial-gradient(600px 220px at 30% 0%, var(--ringA), transparent 62%),
    radial-gradient(600px 240px at 70% 0%, var(--ringB), transparent 62%),
    radial-gradient(700px 260px at 50% 110%, rgba(255,209,122,.14), transparent 62%);
  filter: drop-shadow(0 0 18px rgba(255,209,122,.38));
}
body.fire1 .fireRing,
body.fire2 .fireRing,
body.fire3 .fireRing{opacity:1; animation: firePulse 0.9s ease-in-out infinite}
body.fire3 .fireRing{animation-duration:.65s;}
@keyframes firePulse{
  0%,100%{filter: drop-shadow(0 0 22px var(--pulse1));}
  50%{filter: drop-shadow(0 0 44px var(--pulse2));}
}

/* Fire notification */
.fireBanner{
  position:fixed;
  left:50%;
  top: calc(env(safe-area-inset-top) + 92px);
  transform: translateX(-50%) translateY(-8px);
  z-index:90;

  display:flex;
  align-items:center;
  gap:14px;
  padding:16px 22px;
  border-radius:999px;

  background: rgba(255,209,122,.30);
  border:1px solid rgba(255,209,122,.55);
  box-shadow:
    0 18px 50px rgba(0,0,0,.55),
    0 0 90px rgba(255,120,70, calc(.10 + var(--fireSpark)*.12));
  backdrop-filter: blur(6px);

  opacity:0;
  pointer-events:none;
  transition: opacity .18s ease, transform .18s ease;
  text-align:center;
}
.fireBanner.show{
  opacity:1;
  transform: translateX(-50%) translateY(0);
}
.fireBanner .en{
  font-family:'Cinzel',serif;
  font-weight:900;
  letter-spacing:.4px;
  font-size:22px;
  line-height:1.05;
}
.fireBanner .jp{
  font-family:'Noto Sans JP',sans-serif;
  font-weight:900;
  font-size:18px;
  line-height:1.05;
  opacity:.95;
}
.fireDot{
  width:16px;height:16px;border-radius:999px;
  background: radial-gradient(circle at 30% 30%, #fff6d8, #ffd17a 45%, #ff6b3d 100%);
  box-shadow: 0 0 24px rgba(255,209,122,.70);
}

/* FX layers */
.fx{position:fixed; inset:0; pointer-events:none; z-index:60;}

/* Heart SVG */
.heartSvg{
  position:absolute;
  left:50%;
  top:50%;
  width:160px;
  height:160px;
  transform: translate(-50%,-50%) scale(.75);
  opacity:0;
  filter: drop-shadow(0 0 18px rgba(255,209,122,.35));
}
.heartSvg.show{opacity:1; animation: popHeart .65s ease-out forwards;}
@keyframes popHeart{
  0%{transform: translate(-50%,-50%) scale(.55); opacity:0}
  35%{transform: translate(-50%,-55%) scale(1.08); opacity:1}
  70%{transform: translate(-50%,-62%) scale(.98); opacity:.95}
  100%{transform: translate(-50%,-72%) scale(.92); opacity:0}
}

/* Fart cloud */
.fart{
  position:absolute;
  left:50%;
  top:50%;
  transform: translate(-50%,-50%) scale(.9);
  width:220px;
  height:160px;
  opacity:0;
}
.fart .blob{
  position:absolute;
  inset:0;
  border-radius: 999px;
  background:
    radial-gradient(circle at 30% 30%, rgba(255,255,255,.92), rgba(203,213,225,.92) 38%, rgba(148,163,184,.95) 100%);
  filter: drop-shadow(0 0 18px rgba(0,0,0,.35));
}
.fart .puff{
  position:absolute;
  width:84px;height:84px;border-radius:999px;
  background:
    radial-gradient(circle at 30% 30%, rgba(255,255,255,.92), rgba(203,213,225,.92) 44%, rgba(148,163,184,.95) 100%);
  filter: drop-shadow(0 0 18px rgba(0,0,0,.35));
}
.fart .p1{left:-18px; top:54px}
.fart .p2{right:-22px; top:62px}
.fart .p3{left:48px; top:-18px; width:92px;height:92px}
.fart .txt{
  position:absolute;
  left:50%;
  top:50%;
  transform: translate(-50%,-50%);
  font-family:'Cinzel',serif;
  font-weight:900;
  letter-spacing:.6px;
  font-size:18px;
  color: rgba(11,16,32,.75);
}
.fart.show{opacity:1; animation: popFart .75s ease-out forwards;}
@keyframes popFart{
  0%{transform: translate(-50%,-50%) scale(.7); opacity:0}
  25%{transform: translate(-50%,-52%) scale(1.03); opacity:1}
  65%{transform: translate(-50%,-58%) scale(.98); opacity:.95}
  100%{transform: translate(-50%,-68%) scale(.92); opacity:0}
}

/* Results */
.results{
  display:none;
  width:min(980px, 100%);
  border-radius:var(--radius);
  background: rgba(15,23,42,.78);
  border:1px solid rgba(255,255,255,.18);
  box-shadow: var(--shadow);
  padding:22px 18px;
  text-align:center;
}
.results.show{display:block}
.results h2{margin:0 0 10px; font-size: clamp(22px, 3vw, 34px)}
.results .sub{font-family:'Noto Sans JP',sans-serif; color:var(--muted); font-weight:800; margin-bottom:14px}
.results .score{font-size: clamp(32px, 4.2vw, 56px); font-weight:900; letter-spacing:.3px}

.btnRow{display:flex; gap:10px; justify-content:center; margin-top:14px; flex-wrap:wrap}
.bigBtn{
  appearance:none;
  border:0;
  border-radius:999px;
  padding:12px 18px;
  font-family:'Cinzel',serif;
  font-weight:900;
  letter-spacing:.4px;
  cursor:pointer;
  background: rgba(255,255,255,.10);
  border:1px solid rgba(255,255,255,.18);
  color:#fff;
  box-shadow: 0 12px 28px rgba(0,0,0,.35);
}
.bigBtn span{font-family:'Noto Sans JP',sans-serif; font-weight:900; font-size:12px; margin-left:10px; opacity:.95}

.footer{
  text-align:center;
  font-family:'Cinzel',serif;
  font-weight:900;
  letter-spacing:.5px;
  color: rgba(255,255,255,.85);
  font-size: 14px;
  padding: 4px 0 0;
}

/* Reduce motion */
@media (prefers-reduced-motion: reduce){
  body::before, body::after{animation:none !important}
  .choice,.heartSvg,.fart,.fireRing,.card{animation:none !important; transition:none !important}
  .choice:hover{transform:none}
}
</style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <button class="back" id="backBtn" aria-label="Back to menu">
        <span aria-hidden="true">←</span> MENU <span class="jp">メニュー</span>
      </button>
      <div class="hud">
        <div class="pill">Q <b id="qNum">1</b>/<span id="qTotal">15</span></div>
        <div class="pill">Score <b id="score">0</b></div>
        <div class="pill">Streak <b id="streak">0</b></div>
      </div>
    </div>

    <div class="stage">
      <div class="card" id="card">
        <div class="fireRing" aria-hidden="true"></div>
        <div class="prompt">
          <div class="jp" id="jpText">—</div>
          <div class="hira" id="hiText">—</div>
        </div>
      </div>

      <div class="grid" id="grid"></div>

      <div class="results" id="results">
        <h2>Finished!</h2>
        <div class="sub">おつかれさま！</div>
        <div class="score"><span id="finalScore">0</span>/<span id="finalTotal">0</span></div>
        <div class="btnRow">
          <button class="bigBtn" id="playAgain">PLAY AGAIN <span>もういちど</span></button>
          <button class="bigBtn" id="back2">BACK TO MENU <span>メニュー</span></button>
        </div>
      </div>
    </div>

    <div class="footer">Bryan’s English School</div>
  </div>

  <div class="fireBanner" id="fireBanner" role="status" aria-live="polite">
    <span class="fireDot" aria-hidden="true"></span>
    <div class="en" id="fireEn">You’re on fire!</div>
    <div class="jp" id="fireJp">ノってきた！</div>
  </div>

  <div class="fx" id="fx">
    <svg class="heartSvg" id="heart" viewBox="0 0 64 64" aria-hidden="true">
      <defs>
        <radialGradient id="hg" cx="30%" cy="25%" r="80%">
          <stop offset="0%" stop-color="rgba(255,255,255,.98)"/>
          <stop offset="45%" stop-color="rgba(255,209,122,.98)"/>
          <stop offset="100%" stop-color="rgba(255,126,185,.98)"/>
        </radialGradient>
      </defs>
      <path fill="url(#hg)" d="M32 56s-20-12.6-26.8-25C-.3 18.6 8 8.6 19.5 12.2c5 1.6 8.2 6.2 12.5 11 4.3-4.8 7.5-9.4 12.5-11C56 8.6 64.3 18.6 58.8 31 52 43.4 32 56 32 56z"/>
    </svg>

    <div class="fart" id="fart">
      <div class="blob"></div>
      <div class="puff p1"></div>
      <div class="puff p2"></div>
      <div class="puff p3"></div>
      <div class="txt">NO!</div>
    </div>
  </div>

<script>
/* =========================
   Booha Review – Pick the Sentence (January)
   ✅ Requirements:
   - Preload + fast SFX (same folder): ding.mp3, fart.mp3, fire.mp3
   - Shuffle QUESTIONS order
   - Shuffle ANSWERS each question
   - If wrong: show the correct answer tile
   - Fire visuals: much stronger
   ========================= */

/* --------- SFX POOL (fast, no late audio) --------- */
function makePool(src, size){
  const pool = [];
  for(let i=0;i<size;i++){
    const a = new Audio(src);
    a.preload = "auto";
    a.volume = 1;
    pool.push(a);
  }
  let n = 0;
  return {
    play(vol=1){
      const a = pool[n];
      n = (n+1) % pool.length;
      try{
        a.volume = vol;
        a.currentTime = 0;
        const p = a.play();
        if(p && p.catch) p.catch(()=>{});
      }catch(e){}
    },
    prime(){
      pool.forEach(a=>{
        try{
          const prev = a.volume;
          a.volume = 0;
          a.currentTime = 0;
          const p = a.play();
          if(p && p.then){
            p.then(()=>setTimeout(()=>{
              try{ a.pause(); a.currentTime=0; a.volume=prev; }catch(e){}
            }, 30)).catch(()=>{ try{ a.volume=prev; }catch(e){} });
          }else{
            setTimeout(()=>{ try{ a.pause(); a.currentTime=0; a.volume=prev; }catch(e){} }, 30);
          }
        }catch(e){}
      });
    }
  };
}

/* same-folder SFX */
const SFX = {
  ding: makePool("ding.mp3", 4),
  fart: makePool("fart.mp3", 4),
  fire: makePool("fire.mp3", 3)
};

/* Unlock audio once (iOS Safari) */
let audioUnlocked = false;
function unlockAudioOnce(){
  if(audioUnlocked) return;
  audioUnlocked = true;
  SFX.ding.prime();
  SFX.fart.prime();
  SFX.fire.prime();
}
/* best: global first-gesture unlock */
window.addEventListener("pointerdown", unlockAudioOnce, { once:true, passive:true });
window.addEventListener("touchstart", unlockAudioOnce, { once:true, passive:true });

/* --------- DATA --------- */
const DATA = [
  { jp:"私は毎日勉強します。", hira:"わたし は まいにち べんきょう します。", choices:[
    "I will study every day.",
    "I study will every day.",
    "I will studying every day.",
    "I will study everyday."
  ], correct:0 },

  { jp:"今年、私はベストを尽くします。", hira:"ことし、わたし は べすと を つくします。", choices:[
    "I will do my best this year.",
    "I do my best will this year.",
    "I will doing my best this year.",
    "I am do my best this year."
  ], correct:0 },

  { jp:"私は新しい友だちを作ります。", hira:"わたし は あたらしい ともだち を つくります。", choices:[
    "I will make a new friend.",
    "I will made a new friend.",
    "I make will a new friend.",
    "I will making a new friend."
  ], correct:0 },

  { jp:"私はもう遅刻しません。", hira:"わたし は もう ちこく しません。", choices:[
    "I will not be late anymore.",
    "I will not late anymore.",
    "I not will be late anymore.",
    "I will don't be late anymore."
  ], correct:0 },

  { jp:"私はもっと英語を話します。", hira:"わたし は もっと えいご を はなします。", choices:[
    "I will speak more English.",
    "I speak will more English.",
    "I will speaking more English.",
    "I will speak English more."
  ], correct:0 },

  { jp:"私は７時に起きます。", hira:"わたし は しちじ に おきます。", choices:[
    "I wake up at seven.",
    "I wakes up at seven.",
    "I wake at up seven.",
    "I am wake up at seven."
  ], correct:0 },

  { jp:"私は毎日朝ごはんを食べます。", hira:"わたし は まいにち あさごはん を たべます。", choices:[
    "I eat breakfast every day.",
    "I eats breakfast every day.",
    "I eat breakfast everyday.",
    "I am eat breakfast every day."
  ], correct:0 },

  { jp:"私は８時に学校へ行きます。", hira:"わたし は はちじ に がっこう へ いきます。", choices:[
    "I go to school at eight.",
    "I goes to school at eight.",
    "I go school to at eight.",
    "I am go to school at eight."
  ], correct:0 },

  { jp:"私は寝る前に宿題をします。", hira:"わたし は ねる まえ に しゅくだい を します。", choices:[
    "I do my homework before bed.",
    "I do my homework before the bed.",
    "I am do my homework before bed.",
    "I do homework my before bed."
  ], correct:0 },

  { jp:"私は毎日学校へ歩いて行きます。", hira:"わたし は まいにち がっこう へ あるいて いきます。", choices:[
    "I walk to school every day.",
    "I walks to school every day.",
    "I walk school to every day.",
    "I am walk to school every day."
  ], correct:0 },

  { jp:"朝ごはんを食べたほうがいいです。", hira:"あさごはん を たべた ほう が いい です。", choices:[
    "You should eat breakfast.",
    "You should to eat breakfast.",
    "You should eating breakfast.",
    "You eat breakfast should."
  ], correct:0 },

  { jp:"手を洗わなければなりません。", hira:"て を あらわ なければ なりません。", choices:[
    "You must wash your hands.",
    "You must to wash your hands.",
    "You wash your hands must.",
    "You must washing your hands."
  ], correct:0 },

  { jp:"ノートを持ってこなければなりません。", hira:"のーと を もってこ なければ なりません。", choices:[
    "You have to bring your notebook.",
    "You have bring to your notebook.",
    "You must bringing your notebook.",
    "You have to brought your notebook."
  ], correct:0 },

  { jp:"疲れたときは休んだほうがいいです。", hira:"つかれた とき は やすんだ ほう が いい です。", choices:[
    "You should rest when you're tired.",
    "You should resting when you're tired.",
    "You should rest when you tired.",
    "You rest should when you're tired."
  ], correct:0 },

  { jp:"ほかの人に親切にしなければなりません。", hira:"ほか の ひと に しんせつ に しなければ なりません。", choices:[
    "You must be kind to others.",
    "You must kind to others.",
    "You must being kind to others.",
    "You are must kind to others."
  ], correct:0 },

  { jp:"私は英語を学びたいです。", hira:"わたし は えいご を まなびたい です。", choices:[
    "I want to learn English.",
    "I want learn English.",
    "I want learning English.",
    "I want to learning English."
  ], correct:0 },

  { jp:"私はもっとがんばりたいです。", hira:"わたし は もっと がんばりたい です。", choices:[
    "I want to try harder.",
    "I want try harder.",
    "I want to trying harder.",
    "I try want harder."
  ], correct:0 },

  { jp:"私はもっと本を読みたいです。", hira:"わたし は もっと ほん を よみたい です。", choices:[
    "I want to read more books.",
    "I want read more books.",
    "I want reading more books.",
    "I want to read books more."
  ], correct:0 },

  { jp:"私は新しい友だちを作りたいです。", hira:"わたし は あたらしい ともだち を つくりたい です。", choices:[
    "I want to make new friends.",
    "I want make new friends.",
    "I want to making new friends.",
    "I want make friends new."
  ], correct:0 },

  { jp:"私はベストを尽くすことができます。", hira:"わたし は べすと を つくす こと が できます。", choices:[
    "I can do my best.",
    "I can to do my best.",
    "I do can my best.",
    "I can doing my best."
  ], correct:0 },

  { jp:"私は少し英語を話せます。", hira:"わたし は すこし えいご を はなせます。", choices:[
    "I can speak a little English.",
    "I can speak little English.",
    "I can to speak a little English.",
    "I speak can a little English."
  ], correct:0 },

  { jp:"私は英語の歌を理解できます。", hira:"わたし は えいご の うた を りかい できます。", choices:[
    "I can understand songs in English.",
    "I can understand English songs in.",
    "I understand can songs in English.",
    "I can understanding songs in English."
  ], correct:0 },

  { jp:"私はクラスメートを手伝えます。", hira:"わたし は くらすめーと を てつだえます。", choices:[
    "I can help my classmates.",
    "I can to help my classmates.",
    "I help can my classmates.",
    "I can helping my classmates."
  ], correct:0 },

  { jp:"私は絵を描くのが得意です。", hira:"わたし は え を かく の が とくい です。", choices:[
    "I'm good at drawing.",
    "I'm good drawing.",
    "I good at drawing.",
    "I'm good at draw."
  ], correct:0 },

  { jp:"私は聞くことが得意です。", hira:"わたし は きく こと が とくい です。", choices:[
    "I'm good at listening.",
    "I'm good listening.",
    "I good at listening.",
    "I'm good at listen."
  ], correct:0 },

  { jp:"私は数学が得意ではありません。", hira:"わたし は すうがく が とくい では ありません。", choices:[
    "I'm not good at math.",
    "I'm not good in math.",
    "I not good at math.",
    "I'm not good to math."
  ], correct:0 },

  { jp:"私は名前を覚えるのが得意です。", hira:"わたし は なまえ を おぼえる の が とくい です。", choices:[
    "I'm good at remembering names.",
    "I'm good remembering names.",
    "I'm good at remember names.",
    "I good at remembering names."
  ], correct:0 },

  { jp:"私は人を元気づけるのが得意です。", hira:"わたし は ひと を げんきづける の が とくい です。", choices:[
    "I'm good at cheering people up.",
    "I'm good cheering people up.",
    "I'm good at cheer people up.",
    "I good at cheering people up."
  ], correct:0 },

  { jp:"私は失敗から学ぶことができます。", hira:"わたし は しっぱい から まなぶ こと が できます。", choices:[
    "I can learn from mistakes.",
    "I can learn of mistakes.",
    "I learn can from mistakes.",
    "I can learning from mistakes."
  ], correct:0 },

  { jp:"私は前向きでいられます。", hira:"わたし は まえむき で いられます。", choices:[
    "I can stay positive.",
    "I can stay positivity.",
    "I stay can positive.",
    "I can staying positive."
  ], correct:0 },

  { jp:"私は新しいことに挑戦するつもりです。", hira:"わたし は あたらしい こと に ちょうせん する つもり です。", choices:[
    "I'm going to try something new.",
    "I'm going try something new.",
    "I going to try something new.",
    "I'm going to trying something new."
  ], correct:0 },

  { jp:"私はクラスメートを手伝います。", hira:"わたし は くらすめーと を てつだいます。", choices:[
    "I will help my classmates.",
    "I will helps my classmates.",
    "I help will my classmates.",
    "I will helping my classmates."
  ], correct:0 },

  { jp:"私は今日、机を掃除します。", hira:"わたし は きょう つくえ を そうじ します。", choices:[
    "I will clean my desk today.",
    "I will cleaning my desk today.",
    "I clean will my desk today.",
    "I will clean my desk in today."
  ], correct:0 },

  { jp:"私はもっと本を読みます。", hira:"わたし は もっと ほん を よみます。", choices:[
    "I will read more books.",
    "I will reading more books.",
    "I read will more books.",
    "I will read books more."
  ], correct:0 },

  { jp:"私は良い習慣を始めます。", hira:"わたし は いい しゅうかん を はじめます。", choices:[
    "I will start a good habit.",
    "I will start good habit.",
    "I will starting a good habit.",
    "I start will a good habit."
  ], correct:0 },

  { jp:"私は毎週、日記を書きます。", hira:"わたし は まいしゅう にっき を かきます。", choices:[
    "I will write in my diary every week.",
    "I will write my diary every week.",
    "I will writing in my diary every week.",
    "I write will in my diary every week."
  ], correct:0 },

  { jp:"私はもっと早く起きます。", hira:"わたし は もっと はやく おきます。", choices:[
    "I will wake up earlier.",
    "I will wake earlier.",
    "I will waking up earlier.",
    "I wake will up earlier."
  ], correct:0 },

  { jp:"私は授業でよく聞きます。", hira:"わたし は じゅぎょう で よく ききます。", choices:[
    "I will listen carefully in class.",
    "I will listen careful in class.",
    "I will listening carefully in class.",
    "I listen will carefully in class."
  ], correct:0 },

  { jp:"私はもっと笑います。", hira:"わたし は もっと わらいます。", choices:[
    "I will smile more.",
    "I will smiling more.",
    "I smile will more.",
    "I will smile many."
  ], correct:0 },

  { jp:"私は学ぶことを楽しみます。", hira:"わたし は まなぶ こと を たのしみます。", choices:[
    "I will enjoy learning.",
    "I will enjoying learning.",
    "I enjoy will learning.",
    "I will enjoy to learn."
  ], correct:0 },

  { jp:"私は朝にシャワーを浴びます。", hira:"わたし は あさ に しゃわー を あびます。", choices:[
    "I take a shower in the morning.",
    "I takes a shower in the morning.",
    "I take a shower at the morning.",
    "I am take a shower in the morning."
  ], correct:0 },

  { jp:"私は食事のあとに歯をみがきます。", hira:"わたし は しょくじ の あと に は を みがきます。", choices:[
    "I brush my teeth after meals.",
    "I brushes my teeth after meals.",
    "I brush my teeth after meal.",
    "I am brush my teeth after meals."
  ], correct:0 },

  { jp:"私は夕食のあとに英語を勉強します。", hira:"わたし は ゆうしょく の あと に えいご を べんきょう します。", choices:[
    "I study English after dinner.",
    "I studies English after dinner.",
    "I study English after the dinner.",
    "I am study English after dinner."
  ], correct:0 },

  { jp:"私は夕方に家族を手伝います。", hira:"わたし は ゆうがた に かぞく を てつだいます。", choices:[
    "I help my family in the evening.",
    "I helps my family in the evening.",
    "I help my family on the evening.",
    "I am help my family in the evening."
  ], correct:0 },

  { jp:"私は毎週日曜日に部屋を掃除します。", hira:"わたし は まいしゅう にちようび に へや を そうじ します。", choices:[
    "I clean my room every Sunday.",
    "I cleans my room every Sunday.",
    "I clean my room in every Sunday.",
    "I am clean my room every Sunday."
  ], correct:0 },

  { jp:"私は１０時に寝ます。", hira:"わたし は じゅうじ に ねます。", choices:[
    "I sleep at ten o'clock.",
    "I sleeps at ten o'clock.",
    "I sleep in ten o'clock.",
    "I am sleep at ten o'clock."
  ], correct:0 },

  { jp:"私はときどき夜に読みます。", hira:"わたし は ときどき よる に よみます。", choices:[
    "I sometimes read at night.",
    "I sometime read at night.",
    "I sometimes reads at night.",
    "I am sometimes read at night."
  ], correct:0 },

  { jp:"私は学校の前にテレビを決して見ません。", hira:"わたし は がっこう の まえ に てれび を けっして みません。", choices:[
    "I never watch TV before school.",
    "I never watches TV before school.",
    "I don't never watch TV before school.",
    "I never watch TV before the school."
  ], correct:0 },

  { jp:"私はたいてい友だちと昼ごはんを食べます。", hira:"わたし は たいてい ともだち と ひるごはん を たべます。", choices:[
    "I usually eat lunch with friends.",
    "I usually eats lunch with friends.",
    "I eat usually lunch with friends.",
    "I am usually eat lunch with friends."
  ], correct:0 },

  { jp:"私は授業のあとにリラックスします。", hira:"わたし は じゅぎょう の あと に りらっくす します。", choices:[
    "I relax after class.",
    "I relaxes after class.",
    "I am relax after class.",
    "I relax after the class."
  ], correct:0 }
];

/* --------- Hooks --------- */
const grid       = document.querySelector("#grid");
const jpText     = document.querySelector("#jpText");
const hiText     = document.querySelector("#hiText");
const qNum       = document.querySelector("#qNum");
const qTotal     = document.querySelector("#qTotal");
const scoreEl    = document.querySelector("#score");
const streakEl   = document.querySelector("#streak");
const results    = document.querySelector("#results");
const finalScore = document.querySelector("#finalScore");
const finalTotal = document.querySelector("#finalTotal");

const fireBanner = document.querySelector("#fireBanner");
const fireEn     = document.querySelector("#fireEn");
const fireJp     = document.querySelector("#fireJp");

const heart      = document.querySelector("#heart");
const fart       = document.querySelector("#fart");

const backBtn    = document.querySelector("#backBtn");
const back2      = document.querySelector("#back2");
const playAgain  = document.querySelector("#playAgain");

/* --------- State --------- */
let order = [];     // shuffled indices of DATA
let idx = 0;        // position inside order
let score = 0;
let streak = 0;
let locked = false;
let bannerTimer = null;

function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}

/* Fire levels: 3 / 6 / 10 */
function setFireLevelFromStreak(){
  document.body.classList.remove("fire1","fire2","fire3");
  if(streak >= 10) document.body.classList.add("fire3");
  else if(streak >= 6) document.body.classList.add("fire2");
  else if(streak >= 3) document.body.classList.add("fire1");
}

/* FX */
function popHeart(){
  heart.classList.remove("show");
  void heart.getBoundingClientRect();
  heart.classList.add("show");
}
function popFart(){
  fart.classList.remove("show");
  void fart.getBoundingClientRect();
  fart.classList.add("show");
}

/* Fire banner + fire.mp3 */
function showFireBanner(level){
  const msg = {
    1: { en:"You’re on fire!",           jp:"ノってきた！" },
    2: { en:"You’re on mega fire!",      jp:"まじでノってる！" },
    3: { en:"You are a Sūpā Saiya-jin!", jp:"スーパーサイヤ人だ！" }
  }[level];
  if(!msg) return;

  fireEn.textContent = msg.en;
  fireJp.textContent = msg.jp;

  fireBanner.classList.add("show");
  clearTimeout(bannerTimer);
  bannerTimer = setTimeout(()=>fireBanner.classList.remove("show"), 3500);

  SFX.fire.play(1);
}

/* --------- Game Setup --------- */
function resetGame(){
  order = shuffle([...Array(DATA.length)].map((_,i)=>i)); // shuffle QUESTIONS
  idx = 0;
  score = 0;
  streak = 0;
  locked = false;

  document.body.classList.remove("fire1","fire2","fire3");
  fireBanner.classList.remove("show");
  clearTimeout(bannerTimer);

  qTotal.textContent = String(DATA.length);
  finalTotal.textContent = String(DATA.length);
}

/* --------- Render --------- */
function render(){
  locked = false;
  grid.innerHTML = "";
  results.classList.remove("show");

  const item = DATA[order[idx]];
  qNum.textContent = String(idx+1);
  jpText.textContent = item.jp;
  hiText.textContent = item.hira;

  // shuffle ANSWERS
  const mixed = shuffle(item.choices.map((t, i)=>({t, i})));

  mixed.forEach((c)=>{
    const btn = document.createElement("div");
    btn.className = "choice";
    btn.innerHTML = `<div class="en">${c.t}</div>`;
    btn.addEventListener("click", ()=>pick(btn, c.i));
    grid.appendChild(btn);
  });

  scoreEl.textContent = String(score);
  streakEl.textContent = String(streak);
  setFireLevelFromStreak();
}

/* --------- Pick --------- */
function pick(tile, originalIndex){
  if(locked) return;
  locked = true;

  const item = DATA[order[idx]];
  const tiles = [...document.querySelectorAll(".choice")];
  tiles.forEach(t=>t.classList.add("locked"));

  const isCorrect = (originalIndex === item.correct);

  // play sound FIRST (reduces "late" feel)
  if(isCorrect){
    SFX.ding.play(1);
  }else{
    SFX.fart.play(1);
  }

  if(isCorrect){
    tile.classList.add("correct");
    score++;
    streak++;
    popHeart();

    if(streak === 3)  showFireBanner(1);
    if(streak === 6)  showFireBanner(2);
    if(streak === 10) showFireBanner(3);

  }else{
    tile.classList.add("wrong");
    popFart();
    streak = 0;

    // REVEAL correct tile
    // Find the tile that contains the correct choice text (based on item.correct index)
    const correctText = item.choices[item.correct];
    const correctTile = tiles.find(t=>{
      const el = t.querySelector(".en");
      return el && el.textContent === correctText;
    });
    if(correctTile) correctTile.classList.add("revealCorrect");
  }

  scoreEl.textContent = String(score);
  streakEl.textContent = String(streak);
  setFireLevelFromStreak();

  setTimeout(()=>{
    idx++;
    if(idx >= order.length){
      results.classList.add("show");
      finalScore.textContent = String(score);
      grid.innerHTML = "";
      jpText.textContent = "—";
      hiText.textContent = "—";
      return;
    }
    render();
  }, 850); // slightly longer so they can SEE the correct answer
}

/* --------- Buttons --------- */
function goMenu(){ history.back(); }
backBtn && backBtn.addEventListener("click", goMenu);
back2 && back2.addEventListener("click", goMenu);

playAgain && playAgain.addEventListener("click", ()=>{
  resetGame();
  render();
});

/* --------- Boot --------- */
resetGame();
render();
</script>
</body>
</html>
