
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>Booha Review Decks – Yes/No Check (January)</title>
<meta name="theme-color" content="#0b1020" />
<link rel="icon" type="image/png" href="BoohaYellow.png">
<link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@700;900&family=Noto+Sans+JP:wght@500;700;900&display=swap" rel="stylesheet" />

<style>
:root{
  /* core (AUTUMN INK) */
  --bg:#0a0706;              /* ink espresso */
  --panel:#14100e;
  --panel2:#0f0c0b;
  --ink:#ffffff;
  --muted:#d6d0c8;
  --outline:rgba(255,255,255,.16);

  /* feedback */
  --good:#2dd4bf;            /* sea-mint */
  --bad:#fb7185;             /* rose */
  --gold:#f59e0b;            /* copper-gold */

  --shadow: 0 18px 45px rgba(0,0,0,.55);
  --radius:28px;
  --btnR:22px;

  --jpSize: clamp(26px, 3.3vw, 44px);
  --hiSize: clamp(18px, 2.4vw, 30px);
  --enSize: clamp(20px, 2.6vw, 34px);
  --hudSize: 14px;

  /* default calm */
  --fireA: rgba(245,158,11,.10);     /* copper haze */
  --fireB: rgba(34,197,94,.06);      /* moss hint */
  --ringA: rgba(245,158,11,.18);
  --ringB: rgba(45,212,191,.12);
  --pulse1: rgba(245,158,11,.20);
  --pulse2: rgba(45,212,191,.18);

  --unlockGlow: rgba(245,158,11,.00);
  --unlockScale: 1;
  --unlockWobble: 0deg;

  /* background aurora */
  --bgP: rgba(72,22,10,.55);         /* ember-maroon */
  --bgB: rgba(10,78,68,.34);         /* deep teal */
  --bgG: rgba(112,86,28,.30);        /* moss-gold */

  /* storm overlay (off by default) */
  --stormA: rgba(245,158,11,.00);
  --stormB: rgba(45,212,191,.00);
  --stormC: rgba(34,197,94,.00);
  --fireSpark: 0;
}

*{box-sizing:border-box}
html,body{height:100%}

body{
  margin:0;
  background:
    /* deep “ink” base + soft autumn lights */
    radial-gradient(1200px 760px at 22% 16%, var(--bgP), transparent 58%),
    radial-gradient(980px  720px at 78% 22%, var(--bgB), transparent 60%),
    radial-gradient(980px  760px at 52% 92%, var(--bgG), transparent 62%),
    var(--bg);
  color:var(--ink);
  font-family:'Cinzel', serif;
  overflow:hidden;
}

/* aurora overlay — AUTUMN INK */
body::before{
  content:"";
  position:fixed;
  inset:-12%;
  pointer-events:none;
  z-index:0;
  background:
    radial-gradient(900px 650px at 18% 22%, rgba(245,158,11,.18), transparent 60%), /* copper */
    radial-gradient(900px 650px at 82% 28%, rgba(45,212,191,.16), transparent 62%), /* mint */
    radial-gradient(900px 650px at 56% 86%, rgba(34,197,94,.12), transparent 62%),  /* moss */
    radial-gradient(900px 650px at 36% 62%, rgba(251,113,133,.12), transparent 62%);/* rose */
  filter: blur(12px) saturate(1.22);
  opacity:.92;
  mix-blend-mode: screen;
  transform: translate3d(0,0,0);
  animation: auroraDrift 8.5s ease-in-out infinite;
}

@keyframes auroraDrift{
  0%   {transform: translate(-2%, -1%) scale(1.02)}
  50%  {transform: translate( 2%,  1%) scale(1.06)}
  100% {transform: translate(-2%, -1%) scale(1.02)}
}

/* fire storm overlay — AUTUMN INK */
body::after{
  content:"";
  position:fixed;
  inset:-10%;
  pointer-events:none;
  z-index:0;
  background:
    radial-gradient(900px 700px  at 30% 18%, var(--stormA), transparent 62%),
    radial-gradient(1000px 760px at 70% 28%, var(--stormB), transparent 62%),
    radial-gradient(980px 760px  at 50% 86%, var(--stormC), transparent 62%),
    conic-gradient(from 210deg at 50% 45%,
      rgba(245,158,11,  calc(.03 + var(--fireSpark)*.07)), /* copper */
      rgba(45,212,191,  calc(.02 + var(--fireSpark)*.07)), /* mint */
      rgba(34,197,94,   calc(.02 + var(--fireSpark)*.07)), /* moss */
      rgba(251,113,133, calc(.02 + var(--fireSpark)*.07)), /* rose */
      rgba(245,158,11,  calc(.03 + var(--fireSpark)*.07))
    );
  filter: blur(14px) saturate(1.38) contrast(1.06);
  opacity: .78;
  mix-blend-mode: screen;
  animation: fireStorm 3.2s ease-in-out infinite;
}

@keyframes fireStorm{
  0%   {transform: translate(-1.5%, -1%) rotate(-2deg) scale(1.02)}
  50%  {transform: translate( 1.5%,  1%) rotate( 2deg) scale(1.06)}
  100% {transform: translate(-1.5%, -1%) rotate(-2deg) scale(1.02)}
}

/* ✅ IMPORTANT: define wildSpin ONCE (used by card + banner) */
@keyframes wildSpin{to{transform: rotate(360deg);}}

/* ===========================
   FIRE LEVELS (AUTUMN INK)
   =========================== */
body.fire1{
  --fireA: rgba(245,158,11,.22);     /* copper glow */
  --fireB: rgba(34,197,94,.14);      /* moss glow */
  --ringA: rgba(245,158,11,.38);
  --ringB: rgba(34,197,94,.26);
  --pulse1: rgba(245,158,11,.42);
  --pulse2: rgba(34,197,94,.36);

  --bgP: rgba(92,28,12,.62);
  --bgB: rgba(8,86,74,.44);
  --bgG: rgba(138,102,28,.42);

  --stormA: rgba(245,158,11,.18);
  --stormB: rgba(34,197,94,.12);
  --stormC: rgba(45,212,191,.10);
  --fireSpark: .55;
}

body.fire2{
  --fireA: rgba(245,158,11,.40);
  --fireB: rgba(45,212,191,.22);
  --ringA: rgba(245,158,11,.62);
  --ringB: rgba(45,212,191,.44);
  --pulse1: rgba(245,158,11,.70);
  --pulse2: rgba(45,212,191,.60);

  --bgP: rgba(120,34,16,.76);
  --bgB: rgba(4,104,92,.54);
  --bgG: rgba(168,120,28,.58);

  --stormA: rgba(245,158,11,.30);
  --stormB: rgba(45,212,191,.22);
  --stormC: rgba(34,197,94,.18);
  --fireSpark: .95;

  --unlockGlow: rgba(245,158,11,.22);
  --unlockScale: 1.01;
  --unlockWobble: 0.35deg;
}

body.fire3{
  --fireA: rgba(45,212,191,.28);
  --fireB: rgba(245,158,11,.42);
  --ringA: rgba(45,212,191,.62);
  --ringB: rgba(245,158,11,.70);
  --pulse1: rgba(45,212,191,.72);
  --pulse2: rgba(245,158,11,.78);

  --bgP: rgba(150,44,20,.66);
  --bgB: rgba(0,118,104,.62);
  --bgG: rgba(205,150,30,.70);

  --stormA: rgba(245,158,11,.46);
  --stormB: rgba(45,212,191,.34);
  --stormC: rgba(34,197,94,.24);
  --fireSpark: 1.25;

  --unlockGlow: rgba(45,212,191,.24);
  --unlockScale: 1.03;
  --unlockWobble: 0.85deg;
}

body.fire4{
  --fireA: rgba(255,255,255,.16);
  --fireB: rgba(45,212,191,.44);
  --ringA: rgba(255,255,255,.46);
  --ringB: rgba(245,158,11,.92);
  --pulse1: rgba(255,255,255,.52);
  --pulse2: rgba(45,212,191,.88);

  --bgP: rgba(175,52,24,.72);
  --bgB: rgba(0,132,118,.70);
  --bgG: rgba(230,170,36,.66);

  --stormA: rgba(245,158,11,.60);
  --stormB: rgba(45,212,191,.46);
  --stormC: rgba(255,255,255,.12);
  --fireSpark: 1.65;

  --unlockGlow: rgba(255,255,255,.18);
  --unlockScale: 1.04;
  --unlockWobble: 1.05deg;
}

body.fire1, body.fire2, body.fire3, body.fire4{
  background:
    radial-gradient(1100px 760px at 50% 16%, var(--fireA), transparent 60%),
    radial-gradient(980px 720px  at 50% 46%, var(--fireB), transparent 62%),
    radial-gradient(980px 760px  at 50% 92%, rgba(245,158,11,.14), transparent 62%),
    radial-gradient(1200px 760px at 28% 18%, var(--bgP), transparent 58%),
    radial-gradient(980px 720px  at 76% 26%, var(--bgB), transparent 60%),
    radial-gradient(980px 760px  at 52% 92%, var(--bgG), transparent 62%),
    var(--bg);
}

body.fire4::after{
  animation-duration: 1.75s;
  filter: blur(14px) saturate(1.75) contrast(1.10);
  opacity: .92;
}

/* concert beams (LEVEL 4 PARTY) — re-colored */
body.fire4::before{
  content:"";
  position:fixed;
  inset:-20%;
  pointer-events:none;
  z-index:0;
  background:
    linear-gradient(115deg, rgba(255,255,255,.10), transparent 35%),
    linear-gradient(245deg, rgba(45,212,191,.12), transparent 40%),
    linear-gradient(300deg, rgba(245,158,11,.12), transparent 42%),
    radial-gradient(900px 700px at 50% 50%, rgba(34,197,94,.10), transparent 60%);
  mix-blend-mode: screen;
  filter: blur(1px) saturate(1.15);
  opacity:.92;
  transform: translate3d(0,0,0);
  animation: concertBeams 2.2s ease-in-out infinite;
}

@keyframes concertBeams{
  0%   {transform: translate(-1%, -1%) rotate(-1.5deg) scale(1.02)}
  50%  {transform: translate( 1%,  1%) rotate( 1.5deg) scale(1.06)}
  100% {transform: translate(-1%, -1%) rotate(-1.5deg) scale(1.02)}
}

/* ========================= */


.wrap{
  position:relative;
  z-index:1;
  height:100%;
  display:flex;
  flex-direction:column;
  padding: max(14px, env(safe-area-inset-top)) 14px max(14px, env(safe-area-inset-bottom));
  gap:12px;
}

.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
}

.back{
  appearance:none;
  border:0;
  background:rgba(255,255,255,.10);
  color:#fff;
  padding:7px 10px;
  font-size:14px;
  gap:8px;
  border-radius:999px;
  font-family:'Cinzel',serif;
  font-weight:900;
  letter-spacing:.4px;
  box-shadow: 0 10px 24px rgba(0,0,0,.35);
  border:1px solid rgba(255,255,255,.18);
  cursor:pointer;
  display:flex;
  align-items:baseline;
  -webkit-tap-highlight-color: transparent;
}
.back span.jp{
  font-family:'Noto Sans JP',sans-serif;
  font-weight:900;
  font-size:10px;
  opacity:.95;
}
.back span[aria-hidden="true"]{font-size:14px;}

.hud{
  display:flex;
  align-items:center;
  gap:10px;
  font-family:'Noto Sans JP',sans-serif;
  font-size:var(--hudSize);
  color:var(--muted);
  user-select:none;
}
.hud .pill{
  padding:8px 10px;
  border-radius:999px;
  background:rgba(255,255,255,.08);
  border:1px solid rgba(255,255,255,.14);
}
.hud b{color:#fff}

.stage{
  flex:1;
  display:flex;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  gap:14px;
  min-height:0;
}

/* ===========================
   MAIN CARD — AUTUMN INK
   (REPLACE ENTIRE BLOCK)
   =========================== */
.card{
  width:min(980px, 100%);
  border-radius:var(--radius);

  /* deep ink panel with warm lift */
  background:
    linear-gradient(180deg,
      rgba(24,18,16,.72),
      rgba(12,9,8,.62)
    );
  border:1px solid rgba(255,255,255,.12);

  box-shadow: var(--shadow);

  padding:18px 18px 16px;
  position:relative;
  overflow:hidden;

  transform: scale(var(--unlockScale)) rotate(var(--unlockWobble));
  transition: transform .25s ease, box-shadow .25s ease;
}

body.fire2 .card,
body.fire3 .card,
body.fire4 .card{
  box-shadow:
    var(--shadow),
    0 0 60px var(--unlockGlow),
    0 0 140px rgba(245,158,11, calc(.06 + var(--fireSpark)*.08)); /* copper glow */
}

body.fire3 .card{ animation: cardThrill 0.85s ease-in-out infinite; }
body.fire4 .card{ animation: cardThrillWild 0.70s ease-in-out infinite; }

@keyframes cardThrill{
  0%,100%{ transform: scale(var(--unlockScale)) rotate(calc(var(--unlockWobble) * -1)); }
  50%{ transform: scale(calc(var(--unlockScale) + .015)) rotate(var(--unlockWobble)); }
}
@keyframes cardThrillWild{
  0%,100%{ transform: scale(var(--unlockScale)) rotate(calc(var(--unlockWobble) * -1)); }
  50%{ transform: scale(calc(var(--unlockScale) + .02)) rotate(var(--unlockWobble)); }
}

.card::before{
  content:"";
  position:absolute;
  inset:-2px;
  border-radius:var(--radius);
  background:
    /* soft top sheen */
    radial-gradient(520px 220px at 30% 0%, rgba(255,255,255,.10), transparent 60%),
    /* copper highlight */
    radial-gradient(560px 260px at 80% 0%, rgba(245,158,11,.14), transparent 62%),
    /* mint + moss lift on bottom */
    radial-gradient(900px 380px at 50% 120%, rgba(45,212,191, calc(.05 + var(--fireSpark)*.06)), transparent 62%),
    radial-gradient(900px 380px at 50% 120%, rgba(34,197,94,  calc(.03 + var(--fireSpark)*.05)), transparent 68%);
  pointer-events:none;
}


body.fire4 .card::after{
  content:"";
  position:absolute;
  inset:-40%;
  background: conic-gradient(from 0deg at 50% 50%,
    rgba(255,214,102,0),
    rgba(255,214,102,.22),
    rgba(255,90,160,.18),
    rgba(90,255,214,.18),
    rgba(120,130,255,.16),
    rgba(255,214,102,.22),
    rgba(255,214,102,0)
  );
  filter: blur(12px);
  opacity:.55;
  mix-blend-mode: screen;
  animation: wildSpin 1.8s linear infinite;
  pointer-events:none;
}

.prompt{
  position:relative;
  z-index:1;
  text-align:center;
  padding:14px 8px 8px;
  transform-origin: 50% 50%;
  will-change: transform;
}

.jp{
  font-family:'Noto Sans JP',sans-serif;
  font-weight:900;
  font-size:var(--jpSize);
  line-height:1.12;
  text-shadow:
    0 2px 0 rgba(0,0,0,.90),
    0 0 10px rgba(0,0,0,.80),
    0 0 18px rgba(0,0,0,.60),
    0 10px 26px rgba(0,0,0,.45);
}
.hira{
  margin-top:10px;
  font-family:'Noto Sans JP',sans-serif;
  font-weight:800;
  font-size:var(--hiSize);
  line-height:1.12;
  color: rgba(255,255,255,.92);
  opacity:.95;
  text-shadow:
    0 2px 0 rgba(0,0,0,.85),
    0 0 10px rgba(0,0,0,.70),
    0 0 18px rgba(0,0,0,.50);
}

.grid{
  width:min(980px, 100%);
  display:grid;
  grid-template-columns: 1fr;
  gap:12px;
}
@media (min-width: 820px){
  .grid{grid-template-columns: 1fr 1fr;}
}

/* ===========================
   CHOICE CARDS — AUTUMN INK
   (REPLACE ENTIRE BLOCK)
   =========================== */
.choice{
  position: relative;
  border-radius: var(--btnR);
  padding: 16px 16px 18px;

  display: flex;
  align-items: center;      /* vertical center */
  justify-content: center;  /* horizontal center */
  text-align: center;
}

  /* warm parchment surface */
  background:
    linear-gradient(180deg,
      rgba(255,247,237,.98),
      rgba(255,241,226,.96)
    );
  border:1px solid rgba(120,72,38,.28);

  box-shadow:
    0 12px 28px rgba(0,0,0,.38),
    inset 0 1px 0 rgba(255,255,255,.65);

  cursor:pointer;
  user-select:none;
  transition: transform .12s ease, filter .12s ease, box-shadow .12s ease;
  overflow:hidden;
}

.choice:hover{
  transform: translateY(-1px);
  box-shadow:
    0 14px 32px rgba(0,0,0,.42),
    inset 0 1px 0 rgba(255,255,255,.75);
}

.choice:active{
  transform: translateY(0px) scale(.985);
}

.choice .en{
  font-family: Arial, Helvetica, sans-serif; /* unchanged */
  font-weight:800;
  font-size: var(--enSize);
  line-height:1.15;

  /* dark ink text */
  color:#1b120c;
}

 .choice .en{
  -webkit-text-stroke: 2px white;
  paint-order: stroke fill;
  text-shadow:
    0 1px 2px rgba(0,0,0,0.25);
}


.choice.locked{pointer-events:none; opacity:.92}

/* ✅ Correct = mint + subtle moss depth (still strong, less “laser green”) */
.choice.correct{
  border-color: rgba(45,212,191,.92);
  box-shadow:
    0 0 0 6px rgba(45,212,191,.22),
    0 0 34px rgba(45,212,191,.55),
    0 0 86px rgba(34,197,94,.22),
    0 12px 28px rgba(0,0,0,.35);
  animation: correctFlash .22s ease-out;
}
@keyframes correctFlash{ from{transform: scale(.96);} to{transform: scale(1);} }

/* ✅ Wrong = rose ink (not stop-sign red) */
.choice.wrong{
  border-color: rgba(251,113,133,.92);
  box-shadow:
    0 0 0 6px rgba(251,113,133,.22),
    0 0 36px rgba(251,113,133,.55),
    0 0 92px rgba(244,63,94,.20),
    0 12px 28px rgba(0,0,0,.35);
  animation: shake .45s ease;
}
@keyframes shake{
  0%,100%{transform:translateX(0)}
  20%{transform:translateX(-10px)}
  40%{transform:translateX(10px)}
  60%{transform:translateX(-7px)}
  80%{transform:translateX(7px)}
}

/* ✅ “Correct glow” state after reveal */
.choice.correctGlow{
  border-color: rgba(45,212,191,.95);
  box-shadow:
    0 0 0 6px rgba(45,212,191,.16),
    0 0 34px rgba(45,212,191,.48),
    0 0 86px rgba(34,197,94,.18),
    0 12px 28px rgba(0,0,0,.35);
}

.choice.yes{
  background: rgba(80, 200, 120, 0.14);
  border-color: rgba(80, 200, 120, 0.35);
}

.choice.no{
  background: rgba(220, 80, 80, 0.14);
  border-color: rgba(220, 80, 80, 0.35);
}
.choice{
  border: 2px solid rgba(255,255,255,0.18); /* default */
}

.choice.yes .en{ color: rgba(30, 120, 70, 0.95); }
.choice.no  .en{ color: rgba(140, 30, 30, 0.95); }
  

/* FIRE RING */
.fireRing{
  position:absolute;
  inset:10px;
  border-radius: calc(var(--radius) - 10px);
  pointer-events:none;
  opacity:0;
  transition: opacity .25s ease;
  background:
    radial-gradient(600px 220px at 30% 0%, var(--ringA), transparent 62%),
    radial-gradient(600px 240px at 70% 0%, var(--ringB), transparent 62%),
    radial-gradient(700px 260px at 50% 110%, rgba(255,209,122,.14), transparent 62%);
  filter: drop-shadow(0 0 18px rgba(255,209,122,.38));
}
body.fire1 .fireRing,
body.fire2 .fireRing,
body.fire3 .fireRing,
body.fire4 .fireRing{
  opacity:1;
  animation: firePulse 0.85s ease-in-out infinite;
}
body.fire3 .fireRing{animation-duration:.65s;}
body.fire4 .fireRing{animation-duration:.55s;}
@keyframes firePulse{
  0%,100%{filter: drop-shadow(0 0 28px var(--pulse1));}
  50%{filter: drop-shadow(0 0 58px var(--pulse2));}
}

/* ===========================
   FIRE BANNER — AUTUMN INK
   (REPLACE ENTIRE BLOCK)
   =========================== */
.fireBanner{
  position: fixed;
  left: 50%;
  top: calc(max(12px, env(safe-area-inset-top)) + 6px);
  transform: translateX(-50%);
  z-index: 70;

  display:grid;
  grid-template-columns:16px 1fr;
  grid-template-rows:auto auto;
  column-gap:10px;
  row-gap:2px;

  padding:12px 14px;
  border-radius:18px;

  border:1px solid rgba(255,255,255,.14);
  background: rgba(20,16,14,.62); /* warm ink */
  box-shadow: 0 16px 50px rgba(0,0,0,.60);

  overflow:hidden;
  backdrop-filter: blur(10px);
  -webkit-backdrop-filter: blur(10px);

  pointer-events:none;
  opacity:0;
  transition: opacity .18s ease;
}
.fireBanner.show{opacity:1}
body.fire1 .fireBanner,
body.fire2 .fireBanner,
body.fire3 .fireBanner,
body.fire4 .fireBanner{opacity:1}

.fireBanner .bannerFX{
  position:absolute;
  inset:-40%;
  pointer-events:none;
  z-index:0;
  background:
    radial-gradient(55% 45% at 20% 20%, rgba(245,158,11,.16), transparent 60%),  /* copper */
    radial-gradient(55% 45% at 82% 22%, rgba(45,212,191,.14), transparent 60%),  /* mint */
    radial-gradient(70% 60% at 50% 92%, rgba(34,197,94,.10), transparent 62%),   /* moss */
    radial-gradient(70% 60% at 50% 60%, rgba(251,113,133,.08), transparent 62%); /* rose */
  filter: blur(10px) saturate(1.25);
  opacity:.88;
  mix-blend-mode: screen;
  animation: bannerDrift 2.8s ease-in-out infinite;
}
@keyframes bannerDrift{
  0%{transform: translate(-1%, -1%) rotate(-1deg) scale(1.02)}
  50%{transform: translate( 1%,  1%) rotate( 1deg) scale(1.06)}
  100%{transform: translate(-1%, -1%) rotate(-1deg) scale(1.02)}
}

.fireDot{
  width:14px;height:14px;border-radius:999px;
  background: radial-gradient(circle at 30% 30%,
    rgba(255,255,255,.92),
    rgba(245,158,11,.95) 45%,
    rgba(217,119,6,.98) 100%
  );
  box-shadow: 0 0 26px rgba(245,158,11,.55);
  grid-column:1;
  grid-row:1 / span 2;
  align-self:center;
  position:relative;
  z-index:2;
}

.fireBanner .en{
  grid-column:2; grid-row:1;
  font-family:'Cinzel',serif;
  font-weight:900;
  letter-spacing:.4px;
  font-size: clamp(18px, 3.1vw, 28px);
  line-height:1.05;
  position:relative;
  z-index:2;
  text-shadow: 0 2px 0 rgba(0,0,0,.35);
}
.fireBanner .jp{
  grid-column:2; grid-row:2;
  margin-top:6px;
  font-family:'Noto Sans JP',sans-serif;
  font-weight:900;
  font-size: clamp(14px, 2.7vw, 20px);
  line-height:1.05;
  opacity:.98;
  position:relative;
  z-index:2;
  text-shadow:
    0 2px 0 rgba(0,0,0,.90),
    0 0 10px rgba(0,0,0,.75),
    0 0 18px rgba(0,0,0,.55);
}

/* banner level looks (AUTUMN INK progression) */
.fireBanner.fire1{
  background: radial-gradient(120% 140% at 20% 20%,
    rgba(245,158,11,.35),
    rgba(20,16,14,.55) 55%,
    rgba(10,7,6,.18) 100%
  );
  border-color: rgba(245,158,11,.35);
}
.fireBanner.fire2{
  background: radial-gradient(120% 140% at 20% 20%,
    rgba(45,212,191,.34),
    rgba(245,158,11,.20) 55%,
    rgba(10,7,6,.18) 100%
  );
  border-color: rgba(45,212,191,.32);
}
.fireBanner.fire3{
  background: radial-gradient(120% 140% at 20% 20%,
    rgba(34,197,94,.30),
    rgba(45,212,191,.22) 55%,
    rgba(10,7,6,.18) 100%
  );
  border-color: rgba(34,197,94,.30);
}
.fireBanner.fire4{
  border-color: rgba(255,255,255,.26);
  background: radial-gradient(120% 160% at 15% 20%,
    rgba(255,255,255,.30),
    rgba(245,158,11,.32) 24%,
    rgba(45,212,191,.28) 52%,
    rgba(34,197,94,.22) 76%,
    rgba(10,7,6,.14) 100%
  );
}

/* level 4 gets the “spin party” but in autumn colors */
.fireBanner.fire4 .bannerFX{
  background:
    conic-gradient(from 0deg,
      rgba(245,158,11,0),
      rgba(245,158,11,.24),
      rgba(45,212,191,.22),
      rgba(34,197,94,.18),
      rgba(251,113,133,.16),
      rgba(245,158,11,.24),
      rgba(245,158,11,0)
    );
  filter: blur(12px) saturate(1.6);
  opacity:.92;
  animation: wildSpin 1.2s linear infinite;
}


/* FX */
.fx{position:fixed; inset:0; pointer-events:none; z-index:60;}
.heartSvg{
  position:absolute;
  left:50%;
  top:50%;
  width:160px;
  height:160px;
  transform: translate(-50%,-50%) scale(.75);
  opacity:0;
  filter: drop-shadow(0 0 18px rgba(255,209,122,.35));
}
.heartSvg.show{opacity:1; animation: popHeart .65s ease-out forwards;}
@keyframes popHeart{
  0%{transform: translate(-50%,-50%) scale(.55); opacity:0}
  35%{transform: translate(-50%,-55%) scale(1.08); opacity:1}
  70%{transform: translate(-50%,-62%) scale(.98); opacity:.95}
  100%{transform: translate(-50%,-72%) scale(.92); opacity:0}
}

.fart{
  position:absolute;
  left:50%;
  top:50%;
  transform: translate(-50%,-50%) scale(.9);
  width:220px;
  height:160px;
  opacity:0;
}
.fart .blob{
  position:absolute;
  inset:0;
  border-radius: 999px;
  background:
    radial-gradient(circle at 30% 30%, rgba(255,255,255,.92), rgba(203,213,225,.92) 38%, rgba(148,163,184,.95) 100%);
  filter: drop-shadow(0 0 18px rgba(0,0,0,.35));
}
.fart .puff{
  position:absolute;
  width:84px;height:84px;border-radius:999px;
  background:
    radial-gradient(circle at 30% 30%, rgba(255,255,255,.92), rgba(203,213,225,.92) 44%, rgba(148,163,184,.95) 100%);
  filter: drop-shadow(0 0 18px rgba(0,0,0,.35));
}
.fart .p1{left:-18px; top:54px}
.fart .p2{right:-22px; top:62px}
.fart .p3{left:48px; top:-18px; width:92px;height:92px}
.fart .txt{
  position:absolute;
  left:50%;
  top:50%;
  transform: translate(-50%,-50%);
  font-family:'Cinzel',serif;
  font-weight:900;
  letter-spacing:.6px;
  font-size:18px;
  color: rgba(11,16,32,.75);
}
.fart.show{opacity:1; animation: popFart .75s ease-out forwards;}
@keyframes popFart{
  0%{transform: translate(-50%,-50%) scale(.7); opacity:0}
  25%{transform: translate(-50%,-52%) scale(1.03); opacity:1}
  65%{transform: translate(-50%,-58%) scale(.98); opacity:.95}
  100%{transform: translate(-50%,-68%) scale(.92); opacity:0}
}

/* results + buttons */
.results{
  display:none;
  width:min(980px, 100%);
  border-radius:var(--radius);
  background: rgba(15,23,42,.78);
  border:1px solid rgba(255,255,255,.18);
  box-shadow: var(--shadow);
  padding:22px 18px;
  text-align:center;
}
.results.show{display:block}
.results h2{margin:0 0 10px; font-size: clamp(22px, 3vw, 34px)}
.results .sub{font-family:'Noto Sans JP',sans-serif; color:var(--muted); font-weight:800; margin-bottom:14px}
.results .score{font-size: clamp(32px, 4.2vw, 56px); font-weight:900; letter-spacing:.3px}

.btnRow{display:flex; gap:10px; justify-content:center; margin-top:14px; flex-wrap:wrap}
.bigBtn{
  appearance:none;
  border:0;
  border-radius:999px;
  padding:12px 18px;
  font-family:'Cinzel',serif;
  font-weight:900;
  letter-spacing:.4px;
  cursor:pointer;
  background: rgba(255,255,255,.10);
  border:1px solid rgba(255,255,255,.18);
  color:#fff;
  box-shadow: 0 12px 28px rgba(0,0,0,.35);
}
.bigBtn span{font-family:'Noto Sans JP',sans-serif; font-weight:900; font-size:12px; margin-left:10px; opacity:.95}

.footer{
  text-align:center;
  font-family:'Cinzel',serif;
  font-weight:900;
  letter-spacing:.5px;
  color: rgba(255,255,255,.85);
  font-size: 14px;
  padding: 4px 0 0;
}

/* ===========================
   NEXT OVERLAY — AUTUMN INK
   (REPLACE ENTIRE BLOCK)
   =========================== */

.nextWrap{
  width:min(980px, 100%);
  display:none;
  justify-content:center;
  margin-top:2px;
}
.nextWrap.show{display:flex}

.nextBtn{
  appearance:none;
  border:0;
  border-radius:999px;
  padding:14px 22px;

  font-family:'Cinzel',serif;
  font-weight:900;
  letter-spacing:.5px;
  cursor:pointer;

  /* copper ink button */
  color:#140f0d;
  background: linear-gradient(
    180deg,
    rgba(245,158,11,.98),
    rgba(217,119,6,.96)
  );
  border:1px solid rgba(245,158,11,.78);

  box-shadow:
    0 16px 40px rgba(0,0,0,.50),
    0 0 70px rgba(245,158,11,.22);

  display:flex;
  align-items:baseline;
  gap:10px;

  transition: transform .12s ease, box-shadow .12s ease;
}

.nextBtn:hover{
  transform: translateY(-1px);
  box-shadow:
    0 18px 44px rgba(0,0,0,.55),
    0 0 90px rgba(245,158,11,.28);
}

.nextBtn:active{
  transform: translateY(0) scale(.985);
}

.nextBtn .jp{
  font-family:'Noto Sans JP',sans-serif;
  font-weight:900;
  font-size:14px;
  color:#140f0d;
  text-shadow:none;
}


/* reduce motion */
@media (prefers-reduced-motion: reduce){
  body::before, body::after{animation:none !important}
  .choice,.heartSvg,.fart,.fireRing,.card{animation:none !important; transition:none !important}
  .choice:hover{transform:none}
}
</style>
</head>

<body>
  <div class="wrap">
    <div class="topbar">
      <button class="back" id="backBtn" aria-label="Back to menu">
        <span aria-hidden="true">←</span> MENU <span class="jp">メニュー</span>
      </button>
      <div class="hud">
        <div class="pill">Q <b id="qNum">1</b>/<span id="qTotal">15</span></div>
        <div class="pill">Score <b id="score">0</b></div>
        <div class="pill">Streak <b id="streak">0</b></div>
      </div>
    </div>

    <div class="stage">
      <div class="card" id="card">
        <div class="fireRing" aria-hidden="true"></div>
        <div class="prompt" id="prompt">
          <div class="jp" id="jpText">—</div>
          <div class="hira" id="hiText">—</div>
        </div>
      </div>

      <div class="grid" id="grid"></div>

      <div class="nextWrap" id="nextWrap">
        <button class="nextBtn" id="nextBtn">NEXT <span class="jp">つぎ</span></button>
      </div>

      <div class="results" id="results">
        <h2>Finished!</h2>
        <div class="sub">おつかれさま！</div>
        <div class="score"><span id="finalScore">0</span>/<span id="finalTotal">0</span></div>
        <div class="btnRow">
          <button class="bigBtn" id="playAgain">PLAY AGAIN <span>もういちど</span></button>
          <button class="bigBtn" id="back2">BACK TO MENU <span>メニュー</span></button>
        </div>
      </div>
    </div>

    <div class="footer">Bryan’s English School</div>
  </div>

  <div class="fireBanner" id="fireBanner" role="status" aria-live="polite">
    <div class="bannerFX" aria-hidden="true"></div>
    <span class="fireDot" aria-hidden="true"></span>
    <div class="en" id="fireEn">You’re on fire!</div>
    <div class="jp" id="fireJp">ノってきた！</div>
  </div>

  <div class="fx" id="fx">
    <svg class="heartSvg" id="heart" viewBox="0 0 64 64" aria-hidden="true">
      <defs>
        <radialGradient id="hg" cx="30%" cy="25%" r="80%">
          <stop offset="0%" stop-color="rgba(255,255,255,.98)"/>
          <stop offset="45%" stop-color="rgba(255,209,122,.98)"/>
          <stop offset="100%" stop-color="rgba(255,126,185,.98)"/>
        </radialGradient>
      </defs>
      <path fill="url(#hg)" d="M32 56s-20-12.6-26.8-25C-.3 18.6 8 8.6 19.5 12.2c5 1.6 8.2 6.2 12.5 11 4.3-4.8 7.5-9.4 12.5-11C56 8.6 64.3 18.6 58.8 31 52 43.4 32 56 32 56z"/>
    </svg>

    <div class="fart" id="fart">
      <div class="blob"></div>
      <div class="puff p1"></div>
      <div class="puff p2"></div>
      <div class="puff p3"></div>
      <div class="txt">NO!</div>
    </div>
  </div>

<script>

/* =========================
   Booha Review – Pick the Sentence (January)
   UPDATES:
   ✅ JP text: stronger black glow
   ✅ Wrong answer: NO "✓ CORRECT" pill; correct answer glows green; student clicks NEXT
   ✅ Fire level 3: keep JP/Hira text from moving (card can still wobble)
   ========================= */

/* ---------- WebAudio SFX (same-folder) ---------- */
const SFX = (() => {
  const AudioCtx = window.AudioContext || window.webkitAudioContext;
  let ctx = null;
  let master = null;
  const buf = new Map();
  let unlocked = false;

  function ensure(){
    if (!ctx) {
      ctx = new AudioCtx();
      master = ctx.createGain();
      master.gain.value = 1;
      master.connect(ctx.destination);
    }
  }

 /* =========================
   REMINDER: PRELOAD ERROR VISIBILITY (OPTIONAL, DEBUG ONLY)
   - Helps you catch 404s or decode errors for level4.mp3
   ========================= */
async function loadOne(name, url){
  ensure();
  const res = await fetch(url, { cache: "force-cache" });
  if(!res.ok) throw new Error(`SFX fetch failed: ${name} -> ${url} (${res.status})`); // ✅ optional debug
  const arr = await res.arrayBuffer();
  const b = await ctx.decodeAudioData(arr);
  buf.set(name, b);
}


  /* =========================
   REMINDER: PRELOAD level4.mp3 (ADD THIS SOUND)
   - Add one more loadOne line inside preload()
   ========================= */
async function preload(){
  ensure();
  const jobs = [
    ["ding","ding.mp3"],
    ["fart","fart.mp3"],
    ["fire","fire.mp3"],
    ["level4","level4.mp3"],
  ].map(([name,url]) => loadOne(name,url).catch(()=>null));
  await Promise.all(jobs);
}


  function unlock(){
    ensure();
    if (unlocked) return;
    unlocked = true;

    if (ctx.state === "suspended") ctx.resume().catch(()=>{});
    const b = ctx.createBuffer(1, 1, 22050);
    const src = ctx.createBufferSource();
    src.buffer = b;
    src.connect(master);
    try { src.start(0); } catch(e) {}
  }

  /* =========================
   REMINDER: PLAY SAFETY FALLBACK (OPTIONAL)
   - If level4 fails to decode/load, it will be silent.
   - This fallback tries "fire" so there’s always feedback.
   ========================= */
function play(name, volume=1){
  if (!ctx) return;
  let b = buf.get(name);

  // ✅ OPTIONAL fallback so it's never silent
  if (!b && name === "level4") b = buf.get("fire");
  if (!b) return;

  if (ctx.state === "suspended") ctx.resume().catch(()=>{});

  const src = ctx.createBufferSource();
  src.buffer = b;

  const g = ctx.createGain();
  g.gain.value = Math.max(0, Math.min(1, volume));

  src.connect(g);
  g.connect(master);

  try { src.start(0); } catch(e) {}
}


  return { preload, unlock, play };
})();

const DATA = [
  // 1
  { prompt:"I will study every day.", answer:"YES", reveal:"I will study every day." },
  // 2
  { prompt:"I study will every day.", answer:"NO", reveal:"I will study every day." },
  // 3
  { prompt:"I will studying every day.", answer:"NO", reveal:"I will study every day." },
  // 4
  { prompt:"I will do my best this year.", answer:"YES", reveal:"I will do my best this year." },
  // 5
  { prompt:"I do my best will this year.", answer:"NO", reveal:"I will do my best this year." },
  // 6
  { prompt:"I will making a new friend.", answer:"NO", reveal:"I will make a new friend." },
  // 7
  { prompt:"I will make a new friend.", answer:"YES", reveal:"I will make a new friend." },
  // 8
  { prompt:"I will not be late anymore.", answer:"YES", reveal:"I will not be late anymore." },
  // 9
  { prompt:"I will don't be late anymore.", answer:"NO", reveal:"I will not be late anymore." },
  // 10
  { prompt:"I will speak more English.", answer:"YES", reveal:"I will speak more English." },

  // 11
  { prompt:"I speak will more English.", answer:"NO", reveal:"I will speak more English." },
  // 12
  { prompt:"I wake up at seven.", answer:"YES", reveal:"I wake up at seven." },
  // 13
  { prompt:"I wakes up at seven.", answer:"NO", reveal:"I wake up at seven." },
  // 14
  { prompt:"I eat breakfast every day.", answer:"YES", reveal:"I eat breakfast every day." },
  // 15
  { prompt:"I eats breakfast every day.", answer:"NO", reveal:"I eat breakfast every day." },
  // 16
  { prompt:"I go to school at eight.", answer:"YES", reveal:"I go to school at eight." },
  // 17
  { prompt:"I goes to school at eight.", answer:"NO", reveal:"I go to school at eight." },
  // 18
  { prompt:"I do my homework before bed.", answer:"YES", reveal:"I do my homework before bed." },
  // 19
  { prompt:"I am do my homework before bed.", answer:"NO", reveal:"I do my homework before bed." },
  // 20
  { prompt:"I walk to school every day.", answer:"YES", reveal:"I walk to school every day." },

  // 21
  { prompt:"I walks to school every day.", answer:"NO", reveal:"I walk to school every day." },
  // 22
  { prompt:"You should eat breakfast.", answer:"YES", reveal:"You should eat breakfast." },
  // 23
  { prompt:"You should to eat breakfast.", answer:"NO", reveal:"You should eat breakfast." },
  // 24
  { prompt:"You must wash your hands.", answer:"YES", reveal:"You must wash your hands." },
  // 25
  { prompt:"You must to wash your hands.", answer:"NO", reveal:"You must wash your hands." },
  // 26
  { prompt:"You have to bring your notebook.", answer:"YES", reveal:"You have to bring your notebook." },
  // 27
  { prompt:"You have bring to your notebook.", answer:"NO", reveal:"You have to bring your notebook." },
  // 28
  { prompt:"You should rest when you're tired.", answer:"YES", reveal:"You should rest when you're tired." },
  // 29
  { prompt:"You should resting when you're tired.", answer:"NO", reveal:"You should rest when you're tired." },
  // 30
  { prompt:"You must be kind to others.", answer:"YES", reveal:"You must be kind to others." },

  // 31
  { prompt:"You must kind to others.", answer:"NO", reveal:"You must be kind to others." },
  // 32
  { prompt:"I want to learn English.", answer:"YES", reveal:"I want to learn English." },
  // 33
  { prompt:"I want learn English.", answer:"NO", reveal:"I want to learn English." },
  // 34
  { prompt:"I want to try harder.", answer:"YES", reveal:"I want to try harder." },
  // 35
  { prompt:"I want to trying harder.", answer:"NO", reveal:"I want to try harder." },
  // 36
  { prompt:"I want to read more books.", answer:"YES", reveal:"I want to read more books." },
  // 37
  { prompt:"I want read more books.", answer:"NO", reveal:"I want to read more books." },
  // 38
  { prompt:"I can do my best.", answer:"YES", reveal:"I can do my best." },
  // 39
  { prompt:"I can doing my best.", answer:"NO", reveal:"I can do my best." },
  // 40
  { prompt:"I can speak a little English.", answer:"YES", reveal:"I can speak a little English." },

  // 41
  { prompt:"I can to speak a little English.", answer:"NO", reveal:"I can speak a little English." },
  // 42
  { prompt:"I can help my classmates.", answer:"YES", reveal:"I can help my classmates." },
  // 43
  { prompt:"I can helping my classmates.", answer:"NO", reveal:"I can help my classmates." },
  // 44
  { prompt:"I'm good at drawing.", answer:"YES", reveal:"I'm good at drawing." },
  // 45
  { prompt:"I'm good drawing.", answer:"NO", reveal:"I'm good at drawing." },
  // 46
  { prompt:"I'm good at listening.", answer:"YES", reveal:"I'm good at listening." },
  // 47
  { prompt:"I'm good at listen.", answer:"NO", reveal:"I'm good at listening." },
  // 48
  { prompt:"I'm not good at math.", answer:"YES", reveal:"I'm not good at math." },
  // 49
  { prompt:"I'm not good in math.", answer:"NO", reveal:"I'm not good at math." },
  // 50
  { prompt:"I'm good at remembering names.", answer:"YES", reveal:"I'm good at remembering names." },

  // 51
  { prompt:"I'm good at remember names.", answer:"NO", reveal:"I'm good at remembering names." },
  // 52
  { prompt:"I'm good at cheering people up.", answer:"YES", reveal:"I'm good at cheering people up." },
  // 53
  { prompt:"I'm good at cheer people up.", answer:"NO", reveal:"I'm good at cheering people up." },
  // 54
  { prompt:"I can learn from mistakes.", answer:"YES", reveal:"I can learn from mistakes." },
  // 55
  { prompt:"I can learning from mistakes.", answer:"NO", reveal:"I can learn from mistakes." },
  // 56
  { prompt:"I can stay positive.", answer:"YES", reveal:"I can stay positive." },
  // 57
  { prompt:"I can staying positive.", answer:"NO", reveal:"I can stay positive." },
  // 58
  { prompt:"I'm going to try something new.", answer:"YES", reveal:"I'm going to try something new." },
  // 59
  { prompt:"I'm going to trying something new.", answer:"NO", reveal:"I'm going to try something new." },
  // 60
  { prompt:"I will write in my diary every week.", answer:"YES", reveal:"I will write in my diary every week." }
];



/* ---------- Hooks ---------- */
const grid       = document.querySelector("#grid");
const jpText     = document.querySelector("#jpText");
const hiText     = document.querySelector("#hiText");
const qNum       = document.querySelector("#qNum");
const qTotal     = document.querySelector("#qTotal");
const scoreEl    = document.querySelector("#score");
const streakEl   = document.querySelector("#streak");
const results    = document.querySelector("#results");
const finalScore = document.querySelector("#finalScore");
const finalTotal = document.querySelector("#finalTotal");

const fireBanner = document.querySelector("#fireBanner");
const fireEn     = document.querySelector("#fireEn");
const fireJp     = document.querySelector("#fireJp");

const heart      = document.querySelector("#heart");
const fart       = document.querySelector("#fart");

const backBtn    = document.querySelector("#backBtn");
const back2      = document.querySelector("#back2");
const playAgain  = document.querySelector("#playAgain");

const nextWrap   = document.querySelector("#nextWrap");
const nextBtn    = document.querySelector("#nextBtn");

const card       = document.querySelector("#card");
const prompt     = document.querySelector("#prompt");

/* ---------- State ---------- */
let order = [];
let idx = 0;
let score = 0;
let streak = 0;
let locked = false;
let pendingAdvance = false;
let lastFireLevel = 0;   // prevents banner/sound spam

/* ---------- Shuffle ---------- */
function shuffle(arr){
  const a = arr.slice();
  for(let i=a.length-1;i>0;i--){
    const j = Math.floor(Math.random()*(i+1));
    [a[i],a[j]] = [a[j],a[i]];
  }
  return a;
}

/* ---------- Fire level thresholds ---------- */
function getFireLevelFromStreak(n){
  if(n >= 15) return 4;
  if(n >= 10) return 3;
  if(n >= 6)  return 2;
  if(n >= 3)  return 1;
  return 0;
}

/* ---------- Fire level (BODY) ---------- */
function applyBodyFireFromStreak(){
  const lv = getFireLevelFromStreak(streak);
  document.body.classList.remove("fire1","fire2","fire3","fire4");
  if(lv) document.body.classList.add(`fire${lv}`);
}

/* ---------- FX ---------- */
function popHeart(){
  if(!heart) return;
  heart.classList.remove("show");
  void heart.getBoundingClientRect();
  heart.classList.add("show");
}
function popFart(){
  if(!fart) return;
  fart.classList.remove("show");
  void fart.getBoundingClientRect();
  fart.classList.add("show");
}

/* ---------- Fire Banner ---------- */
const FIRE_MSG = {
  1: { en:"You are awesome!",                    jp:"すごい！" },
  2: { en:"You are even more awesome!",          jp:"もっとすごい！" },
  3: { en:"What? You are the most awesome!",     jp:"えっ！？一番すごい！" },
  4: { en:"You are the smartest person alive!!!",jp:"あなたは世界一かしこい！！！" }
};

function playLevelSound(lv){
  // keep your current behavior: "fire" for 1-3, special for 4
  if(lv === 1 || lv === 2 || lv === 3){
    SFX.play("fire", 1);
    return;
  }
  if(lv === 4){
    // level4.mp3 preloaded as "level4"
    try{ SFX.play("level4", 1); } catch(e){ SFX.play("fire", 1); }
  }
}

function hideFireBanner(){
  if(!fireBanner) return;
  fireBanner.classList.remove("show","fire1","fire2","fire3","fire4");
}

function showFireBanner(level){
  const msg = FIRE_MSG[level];
  if(!msg || !fireBanner) return;

  // set text
  if(fireEn) fireEn.textContent = msg.en;
  if(fireJp) fireJp.textContent = msg.jp;

  // set banner level class
  fireBanner.classList.remove("fire1","fire2","fire3","fire4");
  fireBanner.classList.add(`fire${level}`);

  // ON (toast mode) — even if you also have body.fireX CSS, this is harmless
  fireBanner.classList.add("show");

  // no timeout: it stays on until streak drops to 0
  playLevelSound(level);
}

/* Call this after streak changes */
function maybeTriggerFire(){
  const lv = getFireLevelFromStreak(streak);

  // If streak reset -> banner off + allow re-triggering
  if(lv === 0){
    lastFireLevel = 0;
    hideFireBanner();
    return;
  }

  // Only trigger when leveling up
  if(lv > lastFireLevel){
    showFireBanner(lv);
    lastFireLevel = lv;
  }
}

/* ---------- Game ---------- */
function resetGame(){
  order = shuffle([...Array(DATA.length)].map((_,i)=>i));
  idx = 0;
  score = 0;
  streak = 0;
  locked = false;
  pendingAdvance = false;
  lastFireLevel = 0;

  document.body.classList.remove("fire1","fire2","fire3","fire4");
  hideFireBanner();

  qTotal.textContent = String(DATA.length);
  finalTotal.textContent = String(DATA.length);

  scoreEl.textContent = "0";
  streakEl.textContent = "0";
  nextWrap.classList.remove("show");
  results.classList.remove("show");
  grid.innerHTML = "";
}

/* ---------- Correct Answer Popup (NO case) ---------- */
function showCorrectPopup(correctSentence){
  // create once
  let pop = document.querySelector("#correctPopup");
  if(!pop){
    pop = document.createElement("div");
    pop.id = "correctPopup";
    pop.style.position = "fixed";
    pop.style.left = "50%";
    pop.style.top = "50%";
    pop.style.transform = "translate(-50%,-50%)";
    pop.style.zIndex = "80";
    pop.style.width = "min(860px, calc(100% - 28px))";
    pop.style.borderRadius = "22px";
    pop.style.padding = "16px 16px 14px";
    pop.style.background = "rgba(0,0,0,.55)";
    pop.style.border = "1px solid rgba(255,255,255,.18)";
    pop.style.boxShadow = "0 22px 60px rgba(0,0,0,.65)";
    pop.style.backdropFilter = "blur(10px)";
    pop.style.webkitBackdropFilter = "blur(10px)";
    pop.style.textAlign = "center";
    pop.style.opacity = "0";
    pop.style.pointerEvents = "none";
    pop.style.transition = "opacity .18s ease";
    pop.innerHTML = `
      <div style="font-family:'Cinzel',serif;font-weight:900;letter-spacing:.04em;font-size:18px;color:rgba(255,255,255,.92);">
        Correct Answer
      </div>
      <div id="correctLine"
           style="margin-top:10px;font-family:Arial,Helvetica,sans-serif;font-weight:900;
                  font-size:clamp(20px,2.8vw,34px);line-height:1.15;color:#fff;
                  text-shadow:0 2px 0 rgba(0,0,0,.55);">
      </div>
      <div style="margin-top:10px;font-family:'Cinzel',serif;font-weight:900;opacity:.9;">
        Tap NEXT
      </div>
    `;
    document.body.appendChild(pop);
  }

  const line = pop.querySelector("#correctLine");
  if(line) line.textContent = correctSentence;

  pop.style.opacity = "1";
  pop.style.pointerEvents = "auto";
}

function hideCorrectPopup(){
  const pop = document.querySelector("#correctPopup");
  if(!pop) return;
  pop.style.opacity = "0";
  pop.style.pointerEvents = "none";
}

/* ---------- Game ---------- */
function render(){
  locked = false;
  pendingAdvance = false;
  nextWrap.classList.remove("show");
  hideCorrectPopup();

  grid.innerHTML = "";
  results.classList.remove("show");

  const item = DATA[order[idx]];
  qNum.textContent = String(idx+1);

  // NO JAPANESE: use these elements as the main prompt (or remove them in HTML later)
  // We'll show the sentence in jpText (main big line) and clear hiText.
  // If you want, rename ids later — for now this keeps changes minimal.
  jpText.textContent = item.prompt;
  hiText.textContent = "";

// Build YES/NO tiles
const yes = document.createElement("div");
yes.className = "choice yes";
yes.innerHTML = `<div class="en">YES</div>`;
yes.addEventListener("click", ()=>pick(yes, "YES"));

const no = document.createElement("div");
no.className = "choice no";
no.innerHTML = `<div class="en">NO</div>`;
no.addEventListener("click", ()=>pick(no, "NO"));

grid.appendChild(yes);
grid.appendChild(no);

  scoreEl.textContent = String(score);
  streakEl.textContent = String(streak);

  applyBodyFireFromStreak();
  maybeTriggerFire();
}

function advance(){
  idx++;
  if(idx >= order.length){
    results.classList.add("show");
    finalScore.textContent = String(score);
    grid.innerHTML = "";
    jpText.textContent = "—";
    hiText.textContent = "—";
    nextWrap.classList.remove("show");
    hideCorrectPopup();
    locked = true;
    return;
  }
  render();
}

function pick(tile, picked){
  if(locked || pendingAdvance) return;
  locked = true;

  const item = DATA[order[idx]];
  const tiles = [...document.querySelectorAll(".choice")];
  tiles.forEach(t=>t.classList.add("locked"));

  const isCorrect = (picked === item.answer);

  if(isCorrect) SFX.play("ding", 1);
  else SFX.play("fart", 1);

  if(isCorrect){
    tile.classList.add("correct");
    score++;
    streak++;
    popHeart();

    scoreEl.textContent = String(score);
    streakEl.textContent = String(streak);

    applyBodyFireFromStreak();
    maybeTriggerFire();

    setTimeout(advance, 650);
    return;
  }

  // WRONG
  tile.classList.add("wrong");
  popFart();

  streak = 0;
  streakEl.textContent = "0";
  applyBodyFireFromStreak();
  maybeTriggerFire();

  // Show correct answer popup (English)
  showCorrectPopup(item.reveal);

  pendingAdvance = true;
  nextWrap.classList.add("show");

  // allow NEXT; keep choices locked
  locked = false;
}

/* ---------- Fire3/4: keep JP text from moving while card animates ---------- */
const prefersReduced = window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;

function parseMatrix2D(t){
  if(!t || t === "none") return null;
  const m = t.match(/matrix\(([^)]+)\)/);
  if(!m) return null;
  const parts = m[1].split(",").map(s=>parseFloat(s.trim()));
  if(parts.length !== 6 || parts.some(n=>Number.isNaN(n))) return null;
  return parts;
}

function invertMatrix2D(m){
  const [a,b,c,d,e,f] = m;
  const det = a*d - b*c;
  if(!det) return null;
  const id = 1/det;
  const na =  d*id;
  const nb = -b*id;
  const nc = -c*id;
  const nd =  a*id;
  const ne = -(na*e + nc*f);
  const nf = -(nb*e + nd*f);
  return [na,nb,nc,nd,ne,nf];
}

let stabilizeRAF = 0;
function stabilizePromptLoop(){
  cancelAnimationFrame(stabilizeRAF);
  if(prefersReduced || !prompt || !card) { if(prompt) prompt.style.transform = "none"; return; }

  const tick = ()=>{
    const isFire = document.body.classList.contains("fire3") || document.body.classList.contains("fire4");
    if(!isFire){
      prompt.style.transform = "none";
      stabilizeRAF = requestAnimationFrame(tick);
      return;
    }

    const m = parseMatrix2D(getComputedStyle(card).transform);
    if(!m){
      prompt.style.transform = "none";
      stabilizeRAF = requestAnimationFrame(tick);
      return;
    }

    const inv = invertMatrix2D(m);
    if(!inv){
      prompt.style.transform = "none";
      stabilizeRAF = requestAnimationFrame(tick);
      return;
    }

    prompt.style.transform = `matrix(${inv[0]},${inv[1]},${inv[2]},${inv[3]},${inv[4]},${inv[5]})`;
    stabilizeRAF = requestAnimationFrame(tick);
  };

  stabilizeRAF = requestAnimationFrame(tick);
}

/* ---------- Buttons ---------- */
function goMenu(){
  history.back();
}

backBtn && backBtn.addEventListener("click", goMenu);
back2  && back2.addEventListener("click", goMenu);

playAgain && playAgain.addEventListener("click", () => {
  resetGame();
  render();
});


nextBtn && nextBtn.addEventListener("click", ()=>{
  if(!pendingAdvance) return;
  pendingAdvance = false;
  nextWrap.classList.remove("show");
  advance();
});

/* ---------- Boot ---------- */
(async function boot(){
  try{ await SFX.preload(); }catch(e){}
  resetGame();
  render();
  stabilizePromptLoop();
})();

window.addEventListener("pointerdown", () => { try{ SFX.unlock(); }catch(e){} }, { once:true, passive:true });
window.addEventListener("touchstart", () => { try{ SFX.unlock(); }catch(e){} }, { once:true, passive:true });

</script>
</body>
</html>
